<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>费用管理系统</title>
  <!-- 引入 Tailwind CSS -->
  <script src="https://cdn.tailwindcss.com"></script>
  <!-- 引入 Font Awesome 图标 -->
  <link href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css" rel="stylesheet">
  
  <!-- 自定义配置 -->
  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            primary: '#1E88E5', // 主色调（蓝色）
            secondary: '#FF9800', // 辅助色（橙色）
            neutral: '#F5F7FA', // 中性色（浅灰）
            dark: '#333647', // 深色文本
          },
          fontFamily: {
            sans: ['Inter', 'system-ui', 'sans-serif'],
          },
        },
      }
    }
  </script>
  
  <style type="text/tailwindcss">
    @layer utilities {
      .content-auto {
        content-visibility: auto;
      }
      .table-shadow {
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
      }
      .btn-hover {
        @apply transition-all duration-300 hover:shadow-md hover:-translate-y-0.5;
      }
      .input-focus {
        @apply focus:border-primary focus:ring-1 focus:ring-primary focus:outline-none;
      }
    }
  </style>
</head>
<body class="bg-gray-50 font-sans text-dark">
  <div class="container mx-auto px-4 py-8 max-w-7xl">
    
    <div class="bg-white rounded-lg shadow-md p-6 mb-6">
      <!-- 搜索区域 -->
      <div class="flex flex-col md:flex-row gap-4 mb-6">
        <div class="flex-1">
          <label for="feeNumber" class="block text-sm font-medium text-gray-700 mb-1">费用编号</label>
          <div class="flex">
            <input 
              type="text" 
              id="feeNumber" 
              class="flex-1 px-4 py-2 border border-gray-300 rounded-l-lg input-focus"
              placeholder="输入费用编号查询（例如：HYNB-240126-0059）"
              value="HYNB-240126-0059"
            >
            <button id="searchBtn" class="bg-primary text-white px-6 py-2 rounded-r-lg btn-hover">
              <i class="fa fa-search mr-2"></i>搜索
            </button>
          </div>
        </div>
      </div>
      
      <!-- 功能按钮区域 -->
      <div class="flex flex-wrap gap-4 mb-6">
        <button id="addFeeBtn" class="bg-primary text-white px-6 py-2 rounded-lg btn-hover flex items-center">
          <i class="fa fa-plus mr-2"></i>新增费用项
        </button>
        
        <div class="relative">
          <button id="adjustFeeBtn" class="bg-secondary text-white px-6 py-2 rounded-lg btn-hover flex items-center">
            <i class="fa fa-cog mr-2"></i>调整费用
            <i class="fa fa-chevron-down ml-2"></i>
          </button>
          <div id="adjustDropdown" class="absolute hidden top-full left-0 mt-1 w-48 bg-white rounded-md shadow-lg border border-gray-200 z-10">
            <div class="py-1">
              <a href="#" class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100" data-action="cover">覆盖</a>
              <a href="#" class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100" data-action="update">更新</a>
              <a href="#" class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100" data-action="accumulate">累加</a>
            </div>
          </div>
        </div>
      </div>
      
      <!-- 费用明细表格 -->
      <div class="overflow-x-auto">
        <table class="min-w-full divide-y divide-gray-200 table-shadow rounded-lg overflow-hidden">
          <thead class="bg-gray-50">
            <tr>
              <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">费用名称</th>
              <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">计费单位</th>
              <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">单价</th>
              <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">数量</th>
              <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">金额</th>
              <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">币别</th>
              <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">备注</th>
              <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">操作</th>
            </tr>
          </thead>
          <tbody id="feeTableBody" class="bg-white divide-y divide-gray-200">
            <!-- 表格数据将通过JS动态生成 -->
          </tbody>
        </table>
      </div>
      
      <!-- 无数据提示 -->
      <div id="emptyState" class="hidden py-16 text-center">
        <i class="fa fa-file-text-o text-gray-300 text-5xl mb-4"></i>
        <p class="text-gray-500">暂无费用数据，请点击"新增费用项"添加</p>
      </div>
    </div>
  </div>
  
  <!-- 新增/编辑费用模态框 -->
  <div id="feeModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden">
    <div class="bg-white rounded-lg w-full max-w-2xl max-h-[90vh] overflow-y-auto">
      <div class="px-6 py-4 border-b border-gray-200 flex justify-between items-center">
        <h3 id="modalTitle" class="text-lg font-semibold text-dark">新增费用项</h3>
        <button id="closeModal" class="text-gray-400 hover:text-gray-500">
          <i class="fa fa-times text-xl"></i>
        </button>
      </div>
      <div class="p-6">
        <form id="feeForm">
          <input type="hidden" id="feeId">
          
          <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
            <div>
              <label for="feeName" class="block text-sm font-medium text-gray-700 mb-1">费用名称 <span class="text-red-500">*</span></label>
              <input 
                type="text" 
                id="feeName" 
                class="w-full px-4 py-2 border border-gray-300 rounded-lg input-focus"
                placeholder="请输入费用名称"
                required
              >
            </div>
            
            <div>
              <label for="feeUnit" class="block text-sm font-medium text-gray-700 mb-1">计费单位 <span class="text-red-500">*</span></label>
              <input 
                type="text" 
                id="feeUnit" 
                class="w-full px-4 py-2 border border-gray-300 rounded-lg input-focus"
                placeholder="例如：KG、箱、件"
                required
              >
            </div>
            
            <div>
              <label for="unitPrice" class="block text-sm font-medium text-gray-700 mb-1">单价 <span class="text-red-500">*</span></label>
              <input 
                type="number" 
                id="unitPrice" 
                class="w-full px-4 py-2 border border-gray-300 rounded-lg input-focus"
                placeholder="请输入单价"
                step="0.01"
                min="0"
                required
              >
            </div>
            
            <div>
              <label for="quantity" class="block text-sm font-medium text-gray-700 mb-1">数量 <span class="text-red-500">*</span></label>
              <input 
                type="number" 
                id="quantity" 
                class="w-full px-4 py-2 border border-gray-300 rounded-lg input-focus"
                placeholder="请输入数量"
                step="0.01"
                min="0"
                required
              >
            </div>
            
            <div>
              <label for="amount" class="block text-sm font-medium text-gray-700 mb-1">金额 <span class="text-red-500">*</span></label>
              <input 
                type="number" 
                id="amount" 
                class="w-full px-4 py-2 border border-gray-300 rounded-lg input-focus bg-gray-50 cursor-not-allowed"
                placeholder="自动计算"
                readonly
              >
            </div>
            
            <div>
              <label for="currency" class="block text-sm font-medium text-gray-700 mb-1">币别 <span class="text-red-500">*</span></label>
              <select 
                id="currency" 
                class="w-full px-4 py-2 border border-gray-300 rounded-lg input-focus"
                required
              >
                <option value="USD">USD（美元）</option>
                <option value="CNY">CNY（人民币）</option>
                <option value="EUR">EUR（欧元）</option>
                <option value="GBP">GBP（英镑）</option>
              </select>
            </div>
            
            <div class="md:col-span-2">
              <label for="remark" class="block text-sm font-medium text-gray-700 mb-1">备注</label>
              <textarea 
                id="remark" 
                class="w-full px-4 py-2 border border-gray-300 rounded-lg input-focus"
                rows="3"
                placeholder="请输入备注信息（可选）"
              ></textarea>
            </div>
          </div>
        </form>
      </div>
      <div class="px-6 py-4 border-t border-gray-200 flex justify-end gap-3">
        <button id="cancelModal" class="px-6 py-2 border border-gray-300 rounded-lg text-gray-700 btn-hover">取消</button>
        <button id="saveFeeBtn" class="px-6 py-2 bg-primary text-white rounded-lg btn-hover">保存</button>
      </div>
    </div>
  </div>
  
  <!-- 上传文件模态框 -->
  <div id="uploadModal" class="fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center hidden">
    <div class="bg-white rounded-lg shadow-xl max-w-3xl w-full max-h-[90vh] overflow-auto relative animate-fade-in">
      <!-- 模态框头部 -->
      <div class="px-6 py-4 border-b border-gray-200 flex items-center justify-between">
        <h3 class="text-xl font-semibold text-gray-800">
          <i class="fa fa-upload text-primary mr-2"></i>
          费用调整
        </h3>
        <button id="closeUploadModal" class="text-gray-400 hover:text-gray-600 transition-colors duration-200 w-8 h-8 flex items-center justify-center rounded-full hover:bg-gray-100">
          <i class="fa fa-times"></i>
        </button>
      </div>

    <!-- 上传说明 -->
    <div class="mt-4 p-2 rounded-lg">
      <div class="flex items-start">
        <i class="fa fa-exclamation-triangle text-red-500 mt-0.5 mr-2"></i>
        <div>
          <h4 class="text-sm font-medium text-red-500 mb-1">注意：修改后订单不支持重新计费，请谨慎操作！</h4>
        </div>
      </div>
    </div>
      <!-- 模态框内容 -->
       
      <div class="px-4 py-3">
        <!-- 上传区域 -->
        <div class="border-2 border-dashed border-gray-300 rounded-lg p-6 text-center hover:border-primary transition-colors duration-200">
          <div class="mb-3">
            <i class="fa fa-cloud-upload text-3xl text-gray-400"></i>
          </div>
          <p class="text-gray-600 mb-2 text-sm">拖拽文件到此处或点击选择文件</p>
          <p class="text-xs text-gray-500 mb-3">支持 Excel (.xlsx, .xls) 和 CSV (.csv) 格式，文件大小不超过 10MB</p>
          <input type="file" id="fileInput" class="hidden" accept=".xlsx,.xls,.csv">
          <button id="selectFileBtn" class="px-3 py-1.5 bg-primary text-white rounded-md hover:bg-primary/90 transition-colors duration-200 text-sm">
            <i class="fa fa-folder-open mr-1.5"></i>选择文件
          </button>
        </div>

        <!-- 已选择的文件列表 -->
        <div id="selectedFiles" class="mt-3 hidden">
          <h4 class="text-sm font-medium text-gray-700 mb-2">已选择的文件：</h4>
          <div class="space-y-2">
            <div class="flex items-center justify-between p-2 bg-gray-50 rounded-md">
              <div class="flex items-center">
                <i class="fa fa-file-excel-o text-green-600 mr-2"></i>
                <div>
                  <p class="text-sm font-medium text-gray-900" id="fileName">费用调整表.xlsx</p>
                  <p class="text-xs text-gray-500" id="fileSize">2.3 MB</p>
                </div>
              </div>
              <button id="removeFileBtn" class="text-red-500 hover:text-red-700 transition-colors duration-200">
                <i class="fa fa-times-circle"></i>
              </button>
            </div>
          </div>
        </div>

      </div>

      <!-- 模态框底部 -->
      <div class="px-4 py-3 border-t border-gray-200 flex items-center justify-between">
        <div class="text-xs text-blue-500">
          <span id="uploadStatus">下载模板</span>
        </div>
        <div class="flex items-center gap-2">
          <button id="cancelUploadBtn" class="px-3 py-1.5 border border-gray-300 text-gray-700 rounded-md hover:bg-gray-50 transition-colors duration-200 focus:outline-none focus:ring-1 focus:ring-primary focus:ring-offset-1 text-sm">
            取消
          </button>
          <button id="startUploadBtn" disabled
            class="px-3 py-1.5 bg-gray-300 text-gray-500 rounded-md cursor-not-allowed text-sm"
            title="请先选择文件">
            <i class="fa fa-upload mr-1"></i>
            开始上传
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- 提示消息组件 -->
  <div id="toast" class="fixed top-4 right-4 px-6 py-3 rounded-lg shadow-lg transform translate-x-full transition-transform duration-300 z-50 flex items-center">
    <i id="toastIcon" class="mr-2 text-xl"></i>
    <span id="toastMessage"></span>
  </div>

  <script>
    // 全局变量
    let feeData = [];
    let currentEditId = null;
    
    // DOM 元素
    const feeTableBody = document.getElementById('feeTableBody');
    const emptyState = document.getElementById('emptyState');
    const feeModal = document.getElementById('feeModal');
    const modalTitle = document.getElementById('modalTitle');
    const feeForm = document.getElementById('feeForm');
    const addFeeBtn = document.getElementById('addFeeBtn');
    const saveFeeBtn = document.getElementById('saveFeeBtn');
    const closeModal = document.getElementById('closeModal');
    const cancelModal = document.getElementById('cancelModal');
    const adjustFeeBtn = document.getElementById('adjustFeeBtn');
    const adjustDropdown = document.getElementById('adjustDropdown');
    const searchBtn = document.getElementById('searchBtn');
    const toast = document.getElementById('toast');
    
    // 上传弹窗相关DOM元素
    const uploadModal = document.getElementById('uploadModal');
    const closeUploadModal = document.getElementById('closeUploadModal');
    const fileInput = document.getElementById('fileInput');
    const selectFileBtn = document.getElementById('selectFileBtn');
    const selectedFiles = document.getElementById('selectedFiles');
    const fileName = document.getElementById('fileName');
    const fileSize = document.getElementById('fileSize');
    const removeFileBtn = document.getElementById('removeFileBtn');
    const cancelUploadBtn = document.getElementById('cancelUploadBtn');
    const startUploadBtn = document.getElementById('startUploadBtn');
    const uploadStatus = document.getElementById('uploadStatus');
    
    // 初始化
    document.addEventListener('DOMContentLoaded', () => {
      // 加载本地存储的数据
      loadFeeData();
      // 渲染表格
      renderFeeTable();
      // 绑定事件
      bindEvents();
    });
    
    // 加载数据
    function loadFeeData() {
      const savedData = localStorage.getItem('feeData');
      if (savedData) {
        feeData = JSON.parse(savedData);
      } else {
        // 初始示例数据
        feeData = [
          {
            id: '1',
            name: '超长费',
            unit: 'KG',
            unitPrice: 25.5,
            quantity: 10,
            amount: 255,
            currency: 'USD',
            remark: '这是一段备注'
          },
          {
            id: '2',
            name: '超重费',
            unit: '箱',
            unitPrice: 50.0,
            quantity: 5,
            amount: 250,
            currency: 'USD',
            remark: '超出重量限制附加费'
          }
        ];
        saveFeeData();
      }
    }
    
    // 保存数据到本地存储
    function saveFeeData() {
      localStorage.setItem('feeData', JSON.stringify(feeData));
    }
    
    // 渲染表格
    function renderFeeTable() {
      if (feeData.length === 0) {
        feeTableBody.innerHTML = '';
        emptyState.classList.remove('hidden');
        return;
      }
      
      emptyState.classList.add('hidden');
      feeTableBody.innerHTML = '';
      
      feeData.forEach(fee => {
        const tr = document.createElement('tr');
        tr.className = 'hover:bg-gray-50 transition-colors';
        tr.innerHTML = `
          <td class="px-6 py-4 whitespace-nowrap">${fee.name}</td>
          <td class="px-6 py-4 whitespace-nowrap">${fee.unit}</td>
          <td class="px-6 py-4 whitespace-nowrap">$${fee.unitPrice.toFixed(2)}</td>
          <td class="px-6 py-4 whitespace-nowrap">${fee.quantity}</td>
          <td class="px-6 py-4 whitespace-nowrap font-medium text-primary">$${fee.amount.toFixed(2)}</td>
          <td class="px-6 py-4 whitespace-nowrap">${fee.currency}</td>
          <td class="px-6 py-4">${fee.remark || '-'}</td>
          <td class="px-6 py-4 whitespace-nowrap">
            <button class="edit-fee text-primary hover:text-primary/80 mr-4" data-id="${fee.id}">
              <i class="fa fa-pencil mr-1"></i>编辑
            </button>
            <button class="delete-fee text-red-500 hover:text-red-600" data-id="${fee.id}">
              <i class="fa fa-trash mr-1"></i>删除
            </button>
          </td>
        `;
        feeTableBody.appendChild(tr);
      });
      
      // 绑定表格行内按钮事件
      document.querySelectorAll('.edit-fee').forEach(btn => {
        btn.addEventListener('click', () => editFee(btn.dataset.id));
      });
      
      document.querySelectorAll('.delete-fee').forEach(btn => {
        btn.addEventListener('click', () => deleteFee(btn.dataset.id));
      });
    }
    
    // 绑定事件
    function bindEvents() {
      // 新增费用项
      addFeeBtn.addEventListener('click', openAddModal);
      
      // 保存费用项
      saveFeeBtn.addEventListener('click', saveFee);
      
      // 关闭模态框
      closeModal.addEventListener('click', closeModalHandler);
      cancelModal.addEventListener('click', closeModalHandler);
      
      // 点击模态框外部关闭
      feeModal.addEventListener('click', (e) => {
        if (e.target === feeModal) closeModalHandler();
      });
      
      // 调整费用下拉菜单
      adjustFeeBtn.addEventListener('click', (e) => {
        e.stopPropagation();
        adjustDropdown.classList.toggle('hidden');
      });
      
      // 点击其他区域关闭下拉菜单
      document.addEventListener('click', () => {
        adjustDropdown.classList.add('hidden');
      });
      
      // 调整下拉菜单项点击事件 - 触发上传弹窗
      document.querySelectorAll('#adjustDropdown a').forEach(link => {
        link.addEventListener('click', (e) => {
          e.preventDefault();
          e.stopPropagation();
          adjustDropdown.classList.add('hidden');
          openUploadModal();
        });
      });
      
      // 上传弹窗相关事件
      closeUploadModal.addEventListener('click', closeUploadModalHandler);
      cancelUploadBtn.addEventListener('click', closeUploadModalHandler);
      selectFileBtn.addEventListener('click', () => fileInput.click());
      removeFileBtn.addEventListener('click', removeSelectedFile);
      startUploadBtn.addEventListener('click', startUpload);
      
      // 文件选择事件
      fileInput.addEventListener('change', handleFileSelect);
      
      // 点击上传弹窗外部关闭
      uploadModal.addEventListener('click', (e) => {
        if (e.target === uploadModal) closeUploadModalHandler();
      });
      
      // 搜索功能
      searchBtn.addEventListener('click', performSearch);
      
      // 单价和数量变化时自动计算金额
      document.getElementById('unitPrice').addEventListener('input', calculateAmount);
      document.getElementById('quantity').addEventListener('input', calculateAmount);
    }
    
    // 打开新增模态框
    function openAddModal() {
      modalTitle.textContent = '新增费用项';
      feeForm.reset();
      document.getElementById('feeId').value = '';
      currentEditId = null;
      feeModal.classList.remove('hidden');
    }
    
    // 打开编辑模态框
    function editFee(id) {
      const fee = feeData.find(item => item.id === id);
      if (!fee) return;
      
      currentEditId = id;
      modalTitle.textContent = '编辑费用项';
      
      document.getElementById('feeId').value = fee.id;
      document.getElementById('feeName').value = fee.name;
      document.getElementById('feeUnit').value = fee.unit;
      document.getElementById('unitPrice').value = fee.unitPrice;
      document.getElementById('quantity').value = fee.quantity;
      document.getElementById('amount').value = fee.amount;
      document.getElementById('currency').value = fee.currency;
      document.getElementById('remark').value = fee.remark || '';
      
      feeModal.classList.remove('hidden');
    }
    
    // 保存费用项
    function saveFee() {
      const name = document.getElementById('feeName').value.trim();
      const unit = document.getElementById('feeUnit').value.trim();
      const unitPrice = parseFloat(document.getElementById('unitPrice').value);
      const quantity = parseFloat(document.getElementById('quantity').value);
      const amount = parseFloat(document.getElementById('amount').value);
      const currency = document.getElementById('currency').value;
      const remark = document.getElementById('remark').value.trim();
      
      // 简单验证
      if (!name || !unit || isNaN(unitPrice) || isNaN(quantity) || isNaN(amount)) {
        showToast('请填写完整且有效的信息', 'error');
        return;
      }
      
      if (currentEditId) {
        // 编辑现有费用
        const index = feeData.findIndex(item => item.id === currentEditId);
        if (index !== -1) {
          feeData[index] = {
            ...feeData[index],
            name,
            unit,
            unitPrice,
            quantity,
            amount,
            currency,
            remark
          };
          showToast('费用项更新成功', 'success');
        }
      } else {
        // 新增费用
        const newFee = {
          id: Date.now().toString(),
          name,
          unit,
          unitPrice,
          quantity,
          amount,
          currency,
          remark
        };
        feeData.unshift(newFee);
        showToast('费用项新增成功', 'success');
      }
      
      // 保存数据并刷新表格
      saveFeeData();
      renderFeeTable();
      closeModalHandler();
    }
    
    // 删除费用项
    function deleteFee(id) {
      if (confirm('确定要删除这个费用项吗？此操作不可撤销。')) {
        feeData = feeData.filter(item => item.id !== id);
        saveFeeData();
        renderFeeTable();
        showToast('费用项删除成功', 'success');
      }
    }
    
    // 计算金额（单价 × 数量）
    function calculateAmount() {
      const unitPrice = parseFloat(document.getElementById('unitPrice').value) || 0;
      const quantity = parseFloat(document.getElementById('quantity').value) || 0;
      const amount = unitPrice * quantity;
      document.getElementById('amount').value = amount.toFixed(2);
    }
    
    // 搜索功能
    function performSearch() {
      const searchValue = document.getElementById('feeNumber').value.trim();
      if (searchValue) {
        showToast(`正在查询编号：${searchValue}`, 'info');
        // 模拟搜索延迟
        setTimeout(() => {
          // 实际项目中这里会调用接口查询
          showToast(`查询完成，共找到${feeData.length}条相关记录`, 'success');
        }, 800);
      } else {
        showToast('请输入费用编号', 'error');
      }
    }
    
    // 关闭模态框
    function closeModalHandler() {
      feeModal.classList.add('hidden');
      feeForm.reset();
      currentEditId = null;
    }
    
    // 显示提示消息
    function showToast(message, type = 'success') {
      const toastMessage = document.getElementById('toastMessage');
      const toastIcon = document.getElementById('toastIcon');
      
      toastMessage.textContent = message;
      
      // 设置图标和样式
      switch(type) {
        case 'success':
          toast.className = 'fixed top-4 right-4 px-6 py-3 rounded-lg shadow-lg transform translate-x-0 transition-transform duration-300 z-50 flex items-center bg-green-50 text-green-700 border-l-4 border-green-400';
          toastIcon.className = 'mr-2 text-xl fa fa-check-circle text-green-500';
          break;
        case 'error':
          toast.className = 'fixed top-4 right-4 px-6 py-3 rounded-lg shadow-lg transform translate-x-0 transition-transform duration-300 z-50 flex items-center bg-red-50 text-red-700 border-l-4 border-red-400';
          toastIcon.className = 'mr-2 text-xl fa fa-exclamation-circle text-red-500';
          break;
        case 'info':
          toast.className = 'fixed top-4 right-4 px-6 py-3 rounded-lg shadow-lg transform translate-x-0 transition-transform duration-300 z-50 flex items-center bg-blue-50 text-blue-700 border-l-4 border-blue-400';
          toastIcon.className = 'mr-2 text-xl fa fa-info-circle text-blue-500';
          break;
      }
      
      // 3秒后隐藏
      setTimeout(() => {
        toast.classList.add('translate-x-full');
      }, 3000);
    }
    
    // 打开上传弹窗
    function openUploadModal() {
      uploadModal.classList.remove('hidden');
      resetUploadForm();
    }
    
    // 关闭上传弹窗
    function closeUploadModalHandler() {
      uploadModal.classList.add('hidden');
      resetUploadForm();
    }
    
    // 重置上传表单
    function resetUploadForm() {
      fileInput.value = '';
      selectedFiles.classList.add('hidden');
      startUploadBtn.disabled = true;
      startUploadBtn.className = 'px-4 py-2 bg-gray-300 text-gray-500 rounded-md cursor-not-allowed';
      startUploadBtn.title = '请先选择文件';
      uploadStatus.textContent = '下载模板';
    }
    
    // 处理文件选择
    function handleFileSelect(e) {
      const file = e.target.files[0];
      if (!file) return;
      
      // 验证文件类型
      const allowedTypes = ['.xlsx', '.xls', '.csv'];
      const fileExtension = '.' + file.name.split('.').pop().toLowerCase();
      
      if (!allowedTypes.includes(fileExtension)) {
        showToast('请选择Excel或CSV格式的文件', 'error');
        fileInput.value = '';
        return;
      }
      
      // 验证文件大小（10MB）
      const maxSize = 10 * 1024 * 1024;
      if (file.size > maxSize) {
        showToast('文件大小不能超过10MB', 'error');
        fileInput.value = '';
        return;
      }
      
      // 显示文件信息
      fileName.textContent = file.name;
      fileSize.textContent = formatFileSize(file.size);
      selectedFiles.classList.remove('hidden');
      
      // 启用上传按钮
      startUploadBtn.disabled = false;
      startUploadBtn.className = 'px-4 py-2 bg-primary text-white rounded-md hover:bg-primary/90 transition-colors duration-200';
      startUploadBtn.title = '';
      
      uploadStatus.textContent = '文件已选择，准备上传';
    }
    
    // 移除选中的文件
    function removeSelectedFile() {
      resetUploadForm();
    }
    
    // 开始上传
    function startUpload() {
      const file = fileInput.files[0];
      if (!file) {
        showToast('请先选择文件', 'error');
        return;
      }
      
      // 更新状态
      uploadStatus.textContent = '正在上传...';
      startUploadBtn.disabled = true;
      startUploadBtn.innerHTML = '<i class="fa fa-spinner fa-spin mr-1.5"></i>上传中...';
      
      // 模拟上传过程
      setTimeout(() => {
        // 模拟成功上传
        uploadStatus.textContent = '上传成功';
        showToast('文件上传成功，数据处理完成', 'success');
        
        // 模拟添加新数据
        const newFees = [
          {
            id: Date.now().toString(),
            name: '上传费用-超长费',
            unit: 'KG',
            unitPrice: 28.0,
            quantity: 15,
            amount: 420,
            currency: 'USD',
            remark: '通过文件上传导入'
          },
          {
            id: (Date.now() + 1).toString(),
            name: '上传费用-超重费',
            unit: '箱',
            unitPrice: 55.0,
            quantity: 8,
            amount: 440,
            currency: 'USD',
            remark: '通过文件上传导入'
          }
        ];
        
        // 添加新数据到现有数据
        feeData = [...newFees, ...feeData];
        saveFeeData();
        renderFeeTable();
        
        // 延迟关闭弹窗
        setTimeout(() => {
          closeUploadModalHandler();
        }, 1500);
        
      }, 2000);
    }
    
    // 格式化文件大小
    function formatFileSize(bytes) {
      if (bytes === 0) return '0 Bytes';
      
      const k = 1024;
      const sizes = ['Bytes', 'KB', 'MB', 'GB'];
      const i = Math.floor(Math.log(bytes) / Math.log(k));
      
      return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
    }
  </script>
</body>
</html>