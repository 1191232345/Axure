<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>FleetFlow - è½¦é˜Ÿé¢„çº¦</title>
  <!-- å¼•å…¥Tailwind CSS -->
  <script src="https://cdn.tailwindcss.com"></script>
  <!-- å¼•å…¥Font Awesomeå›¾æ ‡ -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <!-- Tailwindé…ç½®ï¼ˆè‡ªå®šä¹‰é¢œè‰²ã€å·¥å…·ç±»ï¼‰ -->
  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            primary: '#4F46E5', // ä¸»è‰²è°ƒï¼ˆç´«è‰²ç³»ï¼Œä¼ è¾¾ä¸“ä¸šæ„Ÿï¼‰
            secondary: '#64748B', // æ¬¡è¦è‰²è°ƒï¼ˆä¸­æ€§ç°ï¼Œç”¨äºè¾…åŠ©æ–‡å­—ï¼‰
            neutral: '#F8FAFC', // ä¸­æ€§èƒŒæ™¯è‰²
          },
          fontFamily: {
            inter: ['Inter', 'system-ui', 'sans-serif'],
          },
        },
      }
    }
  </script>
  <style type="text/tailwindcss">
    @layer utilities {
      .content-auto {
        content-visibility: auto;
      }
      .transition-fade {
        transition: opacity 0.3s ease-in-out, visibility 0.3s ease-in-out;
      }
      .card-shadow {
        box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.05), 0 2px 4px -1px rgba(0, 0, 0, 0.03);
      }
      .input-focus {
        @apply focus:ring-2 focus:ring-primary/30 focus:border-primary transition-all duration-200;
      }
      /* ç»Ÿä¸€è¾“å…¥æ¡†é«˜åº¦ */
      input, select, textarea {
        @apply h-10;
      }
      .mobile-guide-btn {
        @apply md:hidden fixed right-4 bottom-4 bg-primary text-white w-12 h-12 rounded-full flex items-center justify-center shadow-lg z-50;
      }
    }
  </style>
  
  <!-- è¡¥å……åª’ä½“æŸ¥è¯¢æ ·å¼ä¼˜åŒ–ç§»åŠ¨ç«¯æ˜¾ç¤º -->
  <style>
    @media (max-width: 640px) {
      /* ä¼˜åŒ–ç§»åŠ¨ç«¯è¾“å…¥æ¡†å°ºå¯¸ */
      input:not([disabled]), select:not([disabled]), textarea:not([disabled]) {
        touch-action: manipulation;
      }
      
      /* ç¡®ä¿æ—¶é—´çº¿åœ¨ç§»åŠ¨ç«¯å¯ä»¥æ°´å¹³æ»šåŠ¨ */
      #timeline-container {
        overflow-x: auto;
      }
      
      /* ä¼˜åŒ–æŒ‰é’®è§¦æ‘¸åŒºåŸŸ */
      button {
        min-height: 44px;
        min-width: 44px;
      }
      
      /* ä¼˜åŒ–ç§»åŠ¨ç«¯è¡¨å•æ ‡ç­¾å­—ä½“ */
      label {
        font-size: 0.875rem;
      }
    }
  </style>
</head>
<body class="bg-neutral font-inter min-h-screen">
  <div class="flex flex-col h-screen relative">
    <!-- é¡¶éƒ¨å¯¼èˆªæ  -->
    <header class="bg-white shadow-sm px-4 sm:px-6 py-4 flex justify-between items-center">
      <h1 class="text-lg font-semibold text-gray-800">è½¦é˜Ÿé¢„çº¦</h1>
      <div class="flex items-center space-x-4">
        <button class="flex items-center text-secondary hover:text-primary transition-colors duration-200">
          <i class="fas fa-globe mr-1"></i> è¯­è¨€
        </button>
        <!-- ç™»å½•çŠ¶æ€åŒºåŸŸ -->
        <div id="auth-section" class="flex items-center space-x-3">
          <!-- æœªç™»å½•çŠ¶æ€ -->
          <div id="login-status" class="flex items-center space-x-3">
            <span class="text-sm text-gray-600">æœªç™»å½•</span>
            <button id="login-btn" class="px-3 py-1.5 text-sm font-medium text-white bg-primary rounded-md hover:bg-primary/90 transition-colors duration-200">
              ç™»å½•
            </button>
          </div>
          <!-- å·²ç™»å½•çŠ¶æ€ï¼ˆé»˜è®¤éšè—ï¼‰ -->
          <div id="user-info" class="hidden flex items-center space-x-3">
            <span id="username" class="text-sm text-gray-700"></span>
            <button id="history-btn" class="text-sm text-gray-600 hover:text-primary transition-colors duration-200" title="å†å²è®°å½•">
              <i class="fas fa-history"></i>
            </button>
            <img id="user-avatar" src="https://picsum.photos/32/32" alt="ç”¨æˆ·å¤´åƒ" class="w-8 h-8 rounded-full object-cover border-2 border-primary">
            <button id="logout-btn" class="text-sm text-gray-600 hover:text-primary transition-colors duration-200">
              <i class="fas fa-sign-out-alt"></i>
            </button>
          </div>
        </div>
      </div>
    </header>

    <!-- æ“ä½œæŒ‡å¼•ä¾§è¾¹æ  - æ¡Œé¢ç«¯ -->
    <div id="desktop-guide" class="fixed left-6 top-24 bg-amber-50 border border-amber-200 rounded-lg p-3 w-56 z-40 max-h-[80vh] overflow-auto hidden md:block">
      <div class="flex items-center gap-1.5 mb-1.5">
        <h3 class="font-semibold text-gray-800">ğŸ“‹ æ“ä½œæŒ‡å¼•</h3>
        <span class="px-1.5 py-0.5 bg-amber-100 text-amber-800 text-xs rounded-full">é‡è¦</span>
      </div>
      <ol class="space-y-1.5 text-sm">
        <li class="flex items-start">
          <span class="w-5 h-5 rounded-full bg-primary text-white flex items-center justify-center mr-1.5 text-xs mt-0.5">1</span>
          <span class="text-gray-700">è¾“å…¥ä»“åº“é‚®ç¼–å’ŒæŸœå·</span>
        </li>
        <li class="flex items-start">
          <span class="w-5 h-5 rounded-full bg-primary text-white flex items-center justify-center mr-1.5 text-xs mt-0.5">2</span>
          <span class="text-gray-700">å¡«å†™é¢„çº¦ä¿¡æ¯</span>
        </li>
        <!-- <li class="flex items-start">
          <span class="w-5 h-5 rounded-full bg-primary text-white flex items-center justify-center mr-1.5 text-xs mt-0.5">3</span>
          <span class="text-gray-700">æäº¤é¢„çº¦</span>
        </li> -->
      </ol>
      <p class="mt-2 text-xs text-gray-500 italic">æç¤ºï¼šè¯·æŒ‰ç…§ä¸Šè¿°æ­¥éª¤å®Œæˆè½¦é˜Ÿé¢„çº¦æµç¨‹</p>
    </div>
    
    <!-- æ“ä½œæŒ‡å¼•æŒ‰é’® - ç§»åŠ¨ç«¯ -->
    <button id="mobile-guide-btn" class="mobile-guide-btn" aria-label="æ˜¾ç¤ºæ“ä½œæŒ‡å¼•">
      <i class="fas fa-question text-xl"></i>
    </button>
    
    <!-- æ“ä½œæŒ‡å¼•å¼¹çª— - ç§»åŠ¨ç«¯ -->
    <div id="mobile-guide-modal" class="fixed inset-0 bg-black/50 z-50 flex items-center justify-center hidden">
      <div class="bg-white rounded-lg p-4 m-4 w-full max-w-md">
        <div class="flex justify-between items-center mb-3">
          <div class="flex items-center gap-1.5">
            <h3 class="font-semibold text-gray-800">ğŸ“‹ æ“ä½œæŒ‡å¼•</h3>
            <span class="px-1.5 py-0.5 bg-amber-100 text-amber-800 text-xs rounded-full">é‡è¦</span>
          </div>
          <button id="close-guide-btn" class="text-gray-500 hover:text-gray-700">
            <i class="fas fa-times"></i>
          </button>
        </div>
        <ol class="space-y-2 text-sm">
          <li class="flex items-start">
            <span class="w-5 h-5 rounded-full bg-primary text-white flex items-center justify-center mr-1.5 text-xs mt-0.5">1</span>
            <span class="text-gray-700">æŸ¥è¯¢é¢„çº¦ä¿¡æ¯</span>
          </li>
          <li class="flex items-start">
            <span class="w-5 h-5 rounded-full bg-primary text-white flex items-center justify-center mr-1.5 text-xs mt-0.5">2</span>
            <span class="text-gray-700">å¡«å†™é¢„çº¦ä¿¡æ¯</span>
          </li>
          <li class="flex items-start">
            <span class="w-5 h-5 rounded-full bg-primary text-white flex items-center justify-center mr-1.5 text-xs mt-0.5">3</span>
            <span class="text-gray-700">æäº¤é¢„çº¦ï¼ˆä»…'å¾…é¢„çº¦'å’Œ'å¾…ä»“åº“ç¡®è®¤'çŠ¶æ€ï¼‰</span>
          </li>
        </ol>
        <p class="mt-3 text-xs text-gray-500 italic">æç¤ºï¼šè¯·æŒ‰ç…§ä¸Šè¿°æ­¥éª¤å®Œæˆè½¦é˜Ÿé¢„çº¦æµç¨‹</p>
      </div>
    </div>
    
    <!-- ä¸»å†…å®¹åŒºåŸŸ -->
    <main class="flex-1 overflow-auto p-4 sm:p-6 md:pl-72">

      <!-- ä¸šåŠ¡ç±»å‹é€‰é¡¹å¡åŒºåŸŸ -->
      <div class="mb-4 max-w-6xl mx-auto">
        <!-- ä¸šåŠ¡ç±»å‹é€‰é¡¹å¡ï¼ˆæ•´æŸœ/æ•£è´§ï¼‰ -->
        <div class="inline-flex bg-gray-100 rounded-lg p-1">
          <button type="button" id="tab-full" class="px-4 sm:px-6 py-2 sm:py-3 text-sm font-medium text-primary bg-white rounded-md shadow-sm">æ•´æŸœ</button>
          <button type="button" id="tab-bulk" class="px-4 sm:px-6 py-2 sm:py-3 text-sm font-medium text-gray-600 hover:text-primary transition-colors">æ•£è´§</button>
        </div>
      </div>


      <!-- æœç´¢åŒºåŸŸ -->
      <div class="bg-white p-4 rounded-lg card-shadow mb-4 max-w-6xl mx-auto">
        <div class="grid grid-cols-1 md:grid-cols-12 gap-4 items-end">
          <div class="md:col-span-5">
            <label for="warehouse-postal" class="block text-sm font-medium text-gray-700 mb-1"><span class="text-red-500">*</span>ä»“åº“é‚®ç¼–</label>
            <input type="text" id="warehouse-postal" class="w-full px-3 py-2 border border-gray-300 rounded-md input-focus h-10" placeholder="è¾“å…¥ä»“åº“é‚®ç¼–">
          </div>
          <div class="md:col-span-5">
            <label for="container-no" class="block text-sm font-medium text-gray-700 mb-1"><span class="text-red-500">*</span>æŸœå·</label>
            <input type="text" id="container-no" class="w-full px-3 py-2 border border-gray-300 rounded-md input-focus h-10" placeholder="è¾“å…¥æŸœå·">
          </div>
          <div class="md:col-span-2 flex gap-2">
            <button id="reset-btn" class="px-4 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-md hover:bg-gray-50 transition-colors duration-200 h-10 w-full sm:w-auto">é‡ç½®</button>
            <button id="search-btn" class="px-4 py-2 text-sm font-medium text-white bg-primary rounded-md hover:bg-primary/90 transition-colors duration-200 h-10 w-full sm:w-auto">æœç´¢</button>
          </div>
        </div>
      </div>

      <!-- ä¸»å†…å®¹ï¼šç©ºçŠ¶æ€ï¼ˆé»˜è®¤ï¼‰ & è®¢å•å¡ç‰‡åˆ—è¡¨ï¼ˆæŸ¥è¯¢åï¼‰ -->
      <div class="space-y-4 max-w-6xl mx-auto">
        <!-- è®¢å•å¡ç‰‡åŒºåŸŸ -->
        <div>
          <!-- ç©ºçŠ¶æ€ï¼ˆé»˜è®¤æ˜¾ç¤ºï¼‰ -->
          <div id="empty-state" class="bg-white rounded-lg card-shadow p-6 flex flex-col items-center justify-center min-h-[350px] transition-fade">
            <div class="text-primary/30 text-3xl sm:text-4xl mb-4">
              <i class="fas fa-box-open"></i>
            </div>
            <h3 class="text-lg font-medium text-gray-700 mb-2">æš‚æ— æ•°æ®ï¼Œè¯·æœç´¢è¦é¢„çº¦çš„æŸœå­</h3>
            <p class="text-sm text-gray-500 text-center max-w-xs">è¾“å…¥ä»“åº“é‚®ç¼–å’ŒæŸœå·ï¼Œå³å¯è·å–æŸœå­çš„é¢„çº¦ç›¸å…³ä¿¡æ¯</p>
          </div>

          <!-- æŸ¥è¯¢ç»“æœæç¤º -->
          <div id="search-result-info" class="hidden mb-4 text-sm text-gray-600">
            æŸ¥è¯¢åˆ°<span id="order-count"></span> ä¸ªè®¢å•
          </div>

          <!-- è®¢å•å¡ç‰‡å®¹å™¨ï¼ˆé»˜è®¤éšè—ï¼‰ -->
          <div id="order-cards-container" class="hidden space-y-4 transition-fade">
            <!-- è®¢å•å¡ç‰‡å°†é€šè¿‡JSåŠ¨æ€ç”Ÿæˆ -->
          </div>
        </div>
        
        <!-- ä¸‹æ–¹ï¼šé¢„çº¦ä¿¡æ¯å’Œè½¦é˜Ÿä¿¡æ¯ -->
        <div id="reservation-info-panel" class="hidden bg-white rounded-lg card-shadow p-4 sm:p-5 transition-fade">
          <h3 class="text-base font-medium text-gray-800 mb-4">é¢„çº¦ä¸è½¦é˜Ÿä¿¡æ¯</h3>
          
          <!-- é¢„çº¦ä¿¡æ¯åŒºå— -->
          <div class="mb-5">
            <h4 class="text-sm font-semibold text-gray-700 mb-3">é¢„çº¦ä¿¡æ¯</h4>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
              <div>
                <label class="block text-xs text-gray-500 mb-1"><span class="text-red-500">*</span>å¸è´§æ–¹å¼</label>
                <select id="global-delivery-method" class="w-full px-3 py-2 border border-gray-300 rounded-md">
                  <option value="">è¯·é€‰æ‹©å¸è´§æ–¹å¼</option>
                  <option value="forklift">live</option>
                  <option value="manual">drop</option>
                </select>
              </div>
              <div>
                <label class="block text-xs text-gray-500 mb-1"><span class="text-red-500">*</span>å…¥åº“æ—¶é—´ </label>
                <input type="datetime-local" id="global-warehouse-time" class="w-full px-3 py-2 border border-gray-300 rounded-md">
              </div>
            </div>
          </div>
          
          <!-- è½¦é˜Ÿä¿¡æ¯åŒºå— -->
          <div class="mb-5">
            <h4 class="text-sm font-semibold text-gray-700 mb-3">è½¦é˜Ÿä¿¡æ¯</h4>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
              <div class="md:col-span-1">
                <label class="block text-xs text-gray-500 mb-1"><span class="text-red-500">*</span>åç§°</label>
                <input type="text" id="global-team-name" placeholder="è¯·è¾“å…¥è½¦é˜Ÿåç§°" class="w-full px-3 py-2 border border-gray-300 rounded-md">
              </div>
              <div class="md:col-span-1">
                <label class="block text-xs text-gray-500 mb-1"><span class="text-red-500">*</span>é‚®ç®±</label>
                <input type="text" id="global-team-email" placeholder="è¯·è¾“å…¥è½¦é˜Ÿé‚®ç®±" class="w-full px-3 py-2 border border-gray-300 rounded-md">
                <p id="global-email-error" class="text-red-500 text-xs mt-1 hidden">è¯·è¾“å…¥æœ‰æ•ˆçš„é‚®ç®±åœ°å€</p>
              </div>
              <div>
                <label class="block text-xs text-gray-500 mb-1">ç”µè¯å·ç </label>
                <input type="tel" id="global-team-phone" placeholder="è¯·è¾“å…¥ç”µè¯å·ç " class="w-full px-3 py-2 border border-gray-300 rounded-md">
              </div>
              <div>
                <label class="block text-xs text-gray-500 mb-1">å¤‡ç”¨ç”µè¯å·</label>
                <input type="tel" id="global-team-backup-phone" placeholder="è¯·è¾“å…¥å¤‡ç”¨ç”µè¯å·ç " class="w-full px-3 py-2 border border-gray-300 rounded-md">
              </div>
              <div class="md:col-span-2">
                <label class="block text-xs text-gray-500 mb-1">å¤‡æ³¨</label>
                <textarea id="global-team-remark" placeholder="è¯·è¾“å…¥å¤‡æ³¨ä¿¡æ¯" rows="2" class="w-full px-3 py-2 border border-gray-300 rounded-md"></textarea>
              </div>
            </div>
          </div>
          
          <!-- æäº¤æŒ‰é’®åŒºåŸŸ -->
          <div class="border-t border-gray-100 pt-4">
            <button id="global-submit-btn" class="w-full bg-gray-300 text-gray-500 cursor-not-allowed px-5 py-2 rounded-md transition-colors" disabled>æäº¤é¢„çº¦</button>
          </div>
        </div>

        <!-- æ—¶é—´çº¿åŒºåŸŸå°†åœ¨æ¯ä¸ªè®¢å•å¡ç‰‡å†…æ˜¾ç¤º -->
      </div>

      <!-- æäº¤æŒ‰é’® -->
      <!-- <div class="mt-5 text-center p-4">
        <button id="submit-btn" class="px-6 py-3 text-sm font-medium text-white bg-primary rounded-md hover:bg-primary/90 transition-colors duration-200 disabled:opacity-50 disabled:cursor-not-allowed" disabled>æäº¤é¢„çº¦</button>
      </div> -->
    </main>
  </div>

  <!-- å†å²è®°å½•æ¨¡æ€æ¡† -->
  <div id="history-modal" class="fixed inset-0 bg-black/50 z-50 flex items-center justify-center hidden">
    <div class="bg-white rounded-lg p-6 m-4 w-full max-w-4xl max-h-[90vh] overflow-hidden flex flex-col">
      <div class="flex justify-between items-center mb-4">
        <h3 class="text-lg font-semibold text-gray-800">å†å²é¢„çº¦è®°å½•</h3>
        <button id="history-close" class="text-gray-500 hover:text-gray-700">
          <i class="fas fa-times"></i>
        </button>
      </div>
      
      <!-- ç­›é€‰åŒºåŸŸ -->
      <div class="mb-4 p-4 bg-gray-50 rounded-lg">
        <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-1">å¼€å§‹æ—¥æœŸ</label>
            <input type="date" id="history-start-date" class="w-full px-3 py-2 border border-gray-300 rounded-md">
          </div>
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-1">ç»“æŸæ—¥æœŸ</label>
            <input type="date" id="history-end-date" class="w-full px-3 py-2 border border-gray-300 rounded-md">
          </div>
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-1">è®¢å•çŠ¶æ€</label>
            <select id="history-status-filter" class="w-full px-3 py-2 border border-gray-300 rounded-md">
              <option value="">å…¨éƒ¨çŠ¶æ€</option>
              <option value="pending">å¾…å¤„ç†</option>
              <option value="processing">å¤„ç†ä¸­</option>
              <option value="completed">å·²å®Œæˆ</option>
              <option value="cancelled">å·²å–æ¶ˆ</option>
            </select>
          </div>
          <div class="flex items-end gap-2">
            <button id="history-filter-btn" class="flex-1 px-3 py-2 text-sm font-medium text-white bg-primary rounded-md hover:bg-primary/90 transition-colors">
              ç­›é€‰
            </button>
            <button id="history-reset-btn" class="flex-1 px-3 py-2 text-sm font-medium text-gray-700 bg-gray-200 rounded-md hover:bg-gray-300 transition-colors">
              é‡ç½®
            </button>
          </div>
        </div>
      </div>
      
      <!-- å†å²è®°å½•åˆ—è¡¨ -->
      <div class="flex-1 overflow-y-auto">
        <div id="history-list" class="space-y-4">
          <!-- å†å²è®°å½•é¡¹å°†é€šè¿‡JSåŠ¨æ€ç”Ÿæˆ -->
        </div>
        <div id="history-empty" class="text-center py-8 text-gray-500">
          <i class="fas fa-history text-4xl text-gray-300 mb-4"></i>
          <p>æš‚æ— å†å²è®°å½•</p>
        </div>
      </div>
    </div>
  </div>

  <!-- ç™»å½•æ¨¡æ€æ¡† -->
  <div id="login-modal" class="fixed inset-0 bg-black/50 z-50 flex items-center justify-center hidden">
    <div class="bg-white rounded-lg p-6 m-4 w-full max-w-md">
      <div class="flex justify-between items-center mb-4">
        <h3 class="text-lg font-semibold text-gray-800">ç”¨æˆ·</h3>
        <button id="close-login-btn" class="text-gray-500 hover:text-gray-700">
          <i class="fas fa-times"></i>
        </button>
      </div>
      
      <form id="login-form" class="space-y-4">
        <div>
          <label for="login-username" class="block text-sm font-medium text-gray-700 mb-1">ç”¨æˆ·å</label>
          <input type="text" id="login-username" name="username" required
                 class="w-full px-3 py-2 border border-gray-300 rounded-md input-focus"
                 placeholder="è¯·è¾“å…¥ç”¨æˆ·å">
        </div>
        
        <div>
          <label for="login-password" class="block text-sm font-medium text-gray-700 mb-1">å¯†ç </label>
          <input type="password" id="login-password" name="password" required
                 class="w-full px-3 py-2 border border-gray-300 rounded-md input-focus"
                 placeholder="è¯·è¾“å…¥å¯†ç ">
        </div>
        
        <div class="flex items-center">
          <input type="checkbox" id="remember-me" name="remember" class="mr-2">
          <label for="remember-me" class="text-sm text-gray-600">è®°ä½æˆ‘</label>
        </div>
        
        <div class="flex gap-3 pt-2">
          <button type="submit" 
                  class="flex-1 px-4 py-2 text-sm font-medium text-white bg-primary rounded-md hover:bg-primary/90 transition-colors">
            ç™»å½•
          </button>
        </div>
      </form>
    </div>
  </div>

  <!-- äº¤äº’é€»è¾‘JS -->
  <script>
    document.addEventListener('DOMContentLoaded', function() {
      // åˆå§‹åŒ–é¡µé¢
      const searchBtn = document.getElementById('search-btn');
      const resetBtn = document.getElementById('reset-btn');
      const emptyState = document.getElementById('empty-state');
      const searchResultInfo = document.getElementById('search-result-info');
      const orderCount = document.getElementById('order-count');
      const orderCardsContainer = document.getElementById('order-cards-container');
      const submitBtn = document.getElementById('submit-btn');
      const mobileGuideBtn = document.getElementById('mobile-guide-btn');
      const mobileGuideModal = document.getElementById('mobile-guide-modal');
      const closeGuideBtn = document.getElementById('close-guide-btn');
      // è‡ªåŠ¨å¡«å……è½¦é˜Ÿä¿¡æ¯åˆ°è¡¨å•
      function autoFillTeamInfo() {
        if (currentUser && currentUser.teamName) {
          // å¡«å……å…¨å±€è½¦é˜Ÿä¿¡æ¯è¡¨å•
          const globalTeamNameInput = document.getElementById('global-team-name');
          const globalTeamEmailInput = document.getElementById('global-team-email');
          
          if (globalTeamNameInput) {
            globalTeamNameInput.value = currentUser.teamName;
          }
          
          if (globalTeamEmailInput && currentUser.teamEmail) {
            globalTeamEmailInput.value = currentUser.teamEmail;
          }
          
          // å¦‚æœå·²æœ‰è®¢å•å¡ç‰‡ï¼Œä¹Ÿæ›´æ–°å®ƒä»¬çš„è½¦é˜Ÿä¿¡æ¯
          const teamNameInputs = document.querySelectorAll('input[data-field="teamName"]');
          const teamEmailInputs = document.querySelectorAll('input[data-field="teamEmail"]');
          
          teamNameInputs.forEach(input => {
            if (!input.disabled) {
              input.value = currentUser.teamName;
            }
          });
          
          teamEmailInputs.forEach(input => {
            if (!input.disabled && currentUser.teamEmail) {
              input.value = currentUser.teamEmail;
            }
          });
          
          console.log('è½¦é˜Ÿä¿¡æ¯å·²è‡ªåŠ¨å¡«å……:', {
            teamName: currentUser.teamName,
            teamEmail: currentUser.teamEmail
          });
        }
      }
      
      // ç™»å½•ç›¸å…³DOMå…ƒç´ 
      const loginBtn = document.getElementById('login-btn');
      const logoutBtn = document.getElementById('logout-btn');
      const loginModal = document.getElementById('login-modal');
      const closeLoginBtn = document.getElementById('close-login-btn');
      const cancelLoginBtn = document.getElementById('cancel-login-btn');
      const loginForm = document.getElementById('login-form');
      const loginUsername = document.getElementById('login-username');
      const loginPassword = document.getElementById('login-password');
      const rememberMe = document.getElementById('remember-me');
      const loginStatus = document.getElementById('login-status');
      const userInfo = document.getElementById('user-info');
      const username = document.getElementById('username');
      
      // å†å²è®°å½•ç›¸å…³DOMå…ƒç´ 
      const historyBtn = document.getElementById('history-btn');
      const historyModal = document.getElementById('history-modal');
      const historyClose = document.getElementById('history-close');
      const historyList = document.getElementById('history-list');
      const historyEmpty = document.getElementById('history-empty');
      const historyStartDate = document.getElementById('history-start-date');
      const historyEndDate = document.getElementById('history-end-date');
      const historyStatusFilter = document.getElementById('history-status-filter');
      const historyFilterBtn = document.getElementById('history-filter-btn');
      const historyResetBtn = document.getElementById('history-reset-btn');
      
      // ç™»å½•çŠ¶æ€ç®¡ç†
      let currentUser = null;
      
      // æ£€æŸ¥ç™»å½•çŠ¶æ€
      function checkLoginStatus() {
        const savedUser = localStorage.getItem('currentUser');
        if (savedUser) {
          currentUser = JSON.parse(savedUser);
          updateLoginUI(true);
          hideLoginModal();
          
          // è‡ªåŠ¨å¡«å……è½¦é˜Ÿä¿¡æ¯åˆ°è¡¨å•
          autoFillTeamInfo();
          
          // æ˜¾ç¤ºç™»å½•æˆåŠŸæç¤º
          showToast(`ç™»å½•æˆåŠŸï¼æ¬¢è¿å›æ¥ï¼Œ${username}`);
        } else {
          updateLoginUI(false);
        }
      }
      
      // æ›´æ–°ç™»å½•UIæ˜¾ç¤º
      function updateLoginUI(isLoggedIn) {
        if (isLoggedIn && currentUser) {
          // æ˜¾ç¤ºå·²ç™»å½•çŠ¶æ€
          loginStatus.classList.add('hidden');
          userInfo.classList.remove('hidden');
          username.textContent = currentUser.username;
        } else {
          // æ˜¾ç¤ºæœªç™»å½•çŠ¶æ€
          loginStatus.classList.remove('hidden');
          userInfo.classList.add('hidden');
          username.textContent = '';
          currentUser = null;
          localStorage.removeItem('currentUser');
        }
      }
      
      // æ˜¾ç¤ºç™»å½•æ¨¡æ€æ¡†
      function showLoginModal() {
        loginModal.classList.remove('hidden');
        loginUsername.value = '';
        loginPassword.value = '';
        rememberMe.checked = false;
        loginUsername.focus();
      }
      
      // éšè—ç™»å½•æ¨¡æ€æ¡†
      function hideLoginModal() {
        loginModal.classList.add('hidden');
      }
      
      function handleLogin(e) {
        e.preventDefault();
        
        const username = loginUsername.value.trim();
        const password = loginPassword.value.trim();
        
        if (!username || !password) {
          alert('è¯·è¾“å…¥ç”¨æˆ·åå’Œå¯†ç ');
          return;
        }
        
        // æ¨¡æ‹Ÿç™»å½•éªŒè¯ï¼ˆå®é™…åº”ç”¨ä¸­åº”è¯¥è°ƒç”¨åç«¯APIï¼‰
        if (username && password) {
          // æ ¹æ®ç”¨æˆ·ååˆ†é…è½¦é˜Ÿä¿¡æ¯
          let teamInfo = {};
          if (username === 'demo') {
            teamInfo = {
              teamName: 'demo',
              teamEmail: 'demo@example.com'
            };
          } else if (username === 'admin') {
            teamInfo = {
              teamName: 'demo',
              teamEmail: 'demo@example.com'
            };
          } else {
            // é»˜è®¤è½¦é˜Ÿä¿¡æ¯
            teamInfo = {
              teamName: `${username}è½¦é˜Ÿ`,
              teamEmail: `${username}@example.com`
            };
          }
          
          currentUser = {
            username: username,
            loginTime: new Date().toISOString(),
            ...teamInfo
          };
          
          // å¦‚æœé€‰æ‹©è®°ä½æˆ‘ï¼Œåˆ™ä¿å­˜åˆ°localStorage
          if (rememberMe.checked) {
            localStorage.setItem('currentUser', JSON.stringify(currentUser));
          }
          
          updateLoginUI(true);
          hideLoginModal();
          
          // è‡ªåŠ¨å¡«å……è½¦é˜Ÿä¿¡æ¯åˆ°è¡¨å•
          autoFillTeamInfo();
          
          // æ˜¾ç¤ºç™»å½•æˆåŠŸæç¤º
          showToast(`ç™»å½•æˆåŠŸï¼æ¬¢è¿å›æ¥ï¼Œ${username}`);
        } else {
          alert('ç”¨æˆ·åæˆ–å¯†ç é”™è¯¯');
        }
      }
      
      // å¤„ç†ç™»å‡º
      function handleLogout() {
        if (currentUser && confirm('ç¡®å®šè¦é€€å‡ºç™»å½•å—ï¼Ÿ')) {
          updateLoginUI(false);
          showToast('å·²æˆåŠŸé€€å‡ºç™»å½•');
        }
      }
      
      // æ˜¾ç¤ºæç¤ºæ¶ˆæ¯
      function showToast(message) {
        // åˆ›å»ºæç¤ºå…ƒç´ 
        const toast = document.createElement('div');
        toast.className = 'fixed top-4 right-4 bg-green-500 text-white px-4 py-2 rounded-md shadow-lg z-50 transition-opacity duration-300';
        toast.textContent = message;
        
        document.body.appendChild(toast);
        
        // 3ç§’åè‡ªåŠ¨æ¶ˆå¤±
        setTimeout(() => {
          toast.style.opacity = '0';
          setTimeout(() => {
            document.body.removeChild(toast);
          }, 300);
        }, 3000);
      }
      
      // æœç´¢æŒ‰é’®ç‚¹å‡»äº‹ä»¶
      searchBtn.addEventListener('click', function() {
        // è·å–è¾“å…¥å€¼
        const warehousePostal = document.getElementById('warehouse-postal').value;
        const containerNo = document.getElementById('container-no').value;
        
        // ç®€å•éªŒè¯
        if (!warehousePostal) {
          alert('è¯·è¾“å…¥ä»“åº“é‚®ç¼–');
          return;
        }
        if (!containerNo) {
          alert('è¯·è¾“å…¥æŸœå·');
          return;
        }
        
        console.log('æœç´¢å‚æ•°:', { warehousePostal, containerNo });
        
        // æ˜¾ç¤ºæœç´¢ç»“æœï¼Œéšè—ç©ºçŠ¶æ€
        emptyState.classList.add('hidden');
        searchResultInfo.classList.remove('hidden');
        orderCardsContainer.classList.remove('hidden');
        
        // æ˜¾ç¤ºå³ä¾§é¢„çº¦ä¿¡æ¯é¢æ¿
        document.getElementById('reservation-info-panel').classList.remove('hidden');
        
        // æ›´æ–°è®¢å•æ•°é‡æ˜¾ç¤º
        orderCount.textContent = orderData.length;
        
        // æ¸…ç©ºå¹¶é‡æ–°ç”Ÿæˆè®¢å•å¡ç‰‡
        orderCardsContainer.innerHTML = '';
        orderData.forEach(order => {
          const card = generateOrderCard(order);
          orderCardsContainer.appendChild(card);
        });
      });
      
      // é‡ç½®æŒ‰é’®ç‚¹å‡»äº‹ä»¶
      resetBtn.addEventListener('click', function() {
        document.getElementById('warehouse-postal').value = '';
        document.getElementById('container-no').value = '';
        
        // æ¢å¤åˆå§‹çŠ¶æ€
        emptyState.classList.remove('hidden');
        searchResultInfo.classList.add('hidden');
        orderCardsContainer.classList.add('hidden');
        orderCardsContainer.innerHTML = '';
        
        // éšè—é¢„çº¦ä¿¡æ¯é¢æ¿
        document.getElementById('reservation-info-panel').classList.add('hidden');
      });

      // ç§»åŠ¨ç«¯æ“ä½œæŒ‡å¼•æ˜¾ç¤º/éšè—
      mobileGuideBtn.addEventListener('click', function() {
        mobileGuideModal.classList.remove('hidden');
      });
      
      closeGuideBtn.addEventListener('click', function() {
        mobileGuideModal.classList.add('hidden');
      });
      
      // ç‚¹å‡»å¼¹çª—å¤–éƒ¨å…³é—­
      mobileGuideModal.addEventListener('click', function(e) {
        if (e.target === mobileGuideModal) {
          mobileGuideModal.classList.add('hidden');
        }
      });

      // ç™»å½•ç›¸å…³äº‹ä»¶ç›‘å¬å™¨
      // ç™»å½•æŒ‰é’®ç‚¹å‡»äº‹ä»¶
      if (loginBtn) {
        loginBtn.addEventListener('click', showLoginModal);
      }
      
      // ç™»å‡ºæŒ‰é’®ç‚¹å‡»äº‹ä»¶
      if (logoutBtn) {
        logoutBtn.addEventListener('click', handleLogout);
      }
      
      // å…³é—­ç™»å½•æ¨¡æ€æ¡†
      if (closeLoginBtn) {
        closeLoginBtn.addEventListener('click', hideLoginModal);
      }
      if (cancelLoginBtn) {
        cancelLoginBtn.addEventListener('click', hideLoginModal);
      }
      
      // ç‚¹å‡»æ¨¡æ€æ¡†å¤–éƒ¨å…³é—­
      if (loginModal) {
        loginModal.addEventListener('click', function(e) {
          if (e.target === loginModal) {
            hideLoginModal();
          }
        });
      }
      
      // ç™»å½•è¡¨å•æäº¤äº‹ä»¶
      if (loginForm) {
        loginForm.addEventListener('submit', handleLogin);
      }
      
      // ESCé”®å…³é—­ç™»å½•æ¨¡æ€æ¡†
      document.addEventListener('keydown', function(e) {
        if (e.key === 'Escape' && loginModal && !loginModal.classList.contains('hidden')) {
          hideLoginModal();
        }
      });

      // å†å²è®°å½•ç›¸å…³äº‹ä»¶ç›‘å¬å™¨
      // å†å²è®°å½•æŒ‰é’®ç‚¹å‡»äº‹ä»¶
      if (historyBtn) {
        historyBtn.addEventListener('click', showHistoryModal);
      }
      
      // å…³é—­å†å²è®°å½•æ¨¡æ€æ¡†
      if (historyClose) {
        historyClose.addEventListener('click', hideHistoryModal);
      }
      
      // ç­›é€‰æŒ‰é’®ç‚¹å‡»äº‹ä»¶
      if (historyFilterBtn) {
        historyFilterBtn.addEventListener('click', filterHistoryRecords);
      }
      
      // é‡ç½®ç­›é€‰æŒ‰é’®ç‚¹å‡»äº‹ä»¶
      if (historyResetBtn) {
        historyResetBtn.addEventListener('click', resetHistoryFilter);
      }
      
      // ç‚¹å‡»æ¨¡æ€æ¡†å¤–éƒ¨å…³é—­
      if (historyModal) {
        historyModal.addEventListener('click', function(e) {
          if (e.target === historyModal) {
            hideHistoryModal();
          }
        });
      }
      
      // ESCé”®å…³é—­å†å²è®°å½•æ¨¡æ€æ¡†
      document.addEventListener('keydown', function(e) {
        if (e.key === 'Escape' && historyModal && !historyModal.classList.contains('hidden')) {
          hideHistoryModal();
        }
      });

      // æ ¹æ®è®¢å•çŠ¶æ€è·å–å¯¹åº”çš„æ ·å¼ç±»
      function getStatusStyle(status) {
        if (status === 'å¾…é¢„çº¦') {
          return 'bg-red-100 text-red-800';
        } else if (status === 'å¾…ä»“åº“å®¡æ ¸') {
          return 'bg-orange-100 text-orange-800';
        } else {
          return 'bg-green-100 text-green-800';
        }
      }

      // è®¢å•æ•°æ®ç¤ºä¾‹
      const orderData = [
        {
          id: 1,
          orderNo: 'ORD20241210001',
          warehouseNo: 'WH20241210001',
          contactPerson: 'å¼ ä¸‰',
          contactPhone: '13800138000',
          warehouseAddress: 'åŒ—äº¬å¸‚æœé˜³åŒºå»ºå›½è·¯88å·ä»“åº“AåŒº',
          teamName: 'é¡ºä¸°è½¦é˜Ÿ',
          status: 'å¾…é¢„çº¦'
        },
        {
          id: 2,
          orderNo: 'ORD20241210002',
          warehouseNo: 'WH20241210002',
          contactPerson: 'æå››',
          contactPhone: '13900139000',
          warehouseAddress: 'ä¸Šæµ·å¸‚æµ¦ä¸œæ–°åŒºå¼ æ±Ÿé«˜ç§‘æŠ€å›­åŒºåšäº‘è·¯2å·ä»“åº“BåŒº',
          teamName: 'ä¸­å®¢è½¦é˜Ÿ',
          status: 'å¾…ä»“åº“å®¡æ ¸'
        },
        {
          id: 3,
          orderNo: 'ORD20241210003',
          warehouseNo: 'WH20241210003',
          contactPerson: 'ç‹äº”',
          contactPhone: '13700137000',
          warehouseAddress: 'å¹¿å·å¸‚å¤©æ²³åŒºå¤©æ²³è·¯385å·ä»“åº“CåŒº',
          teamName: 'éŸµè¾¾è½¦é˜Ÿ',
          status: 'å¾…é€ä»“'
        }
      ];

      // ç”Ÿæˆè®¢å•å¡ç‰‡
      function generateOrderCard(orderData) {
        const cardId = `order-card-${orderData.id}`;
        const collapseId = `collapse-${orderData.id}`;
        
        const card = document.createElement('div');
        card.className = 'bg-white rounded-lg card-shadow transition-fade';
        card.id = cardId;
        
        // å¡ç‰‡æ ‡é¢˜éƒ¨åˆ†ï¼ˆå¯ç‚¹å‡»æŠ˜å /å±•å¼€ï¼‰
        card.innerHTML = `
          <div class="p-4 sm:p-5 border-b border-gray-100 flex justify-between items-center cursor-pointer" id="card-header-${orderData.id}">
            <div class="flex items-center gap-2">
              <div class="w-8 h-8 rounded-full bg-primary/10 flex items-center justify-center text-primary">
                <i class="fas fa-box"></i>
              </div>
              <h3 class="text-base font-medium text-gray-800">å…¥åº“å•å·: ${orderData.orderNo}</h3>
                  <span class="px-2 py-0.5 text-xs rounded-full ${getStatusStyle(orderData.status)}">${orderData.status || 'å¾…é¢„çº¦'}</span>
            </div>
            <div class="flex items-center gap-2">
              <span class="text-sm text-gray-500">å‚è€ƒå•å·: ${orderData.warehouseNo}</span>
              <button class="text-gray-400 hover:text-primary transition-colors transform transition-transform duration-200" id="toggle-icon-${orderData.id}">
                <i class="fas fa-chevron-down"></i>
              </button>
            </div>
          </div>
          
          <!-- å¡ç‰‡å†…å®¹ï¼ˆé»˜è®¤æŠ˜å ï¼‰ -->
          <div id="${collapseId}" class="hidden">
            <!-- å·¦å³å¸ƒå±€å®¹å™¨ -->
            <div class="flex flex-col md:flex-row">
              <!-- å·¦ä¾§ï¼šè®¢å•ä¿¡æ¯ -->
              <div class="w-full md:w-3/5 p-4 sm:p-5">
                <!-- åŸºæœ¬ä¿¡æ¯åŒºå— -->
                <div class="mb-5">
                  <h4 class="text-sm font-semibold text-gray-700 mb-3">åŸºæœ¬ä¿¡æ¯</h4>
                  <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div>
                      <label class="block text-xs text-gray-500 mb-1">è®¢å•å·</label>
                      <input type="text" value="${orderData.orderNo}" class="w-full px-3 py-2 border border-gray-300 rounded-md bg-gray-50 cursor-not-allowed" disabled>
                    </div>
                    <div>
                      <label class="block text-xs text-gray-500 mb-1"></label>
                    </div>
                    <div>
                      <label class="block text-xs text-gray-500 mb-1">ä»“åº“è”ç³»äºº</label>
                      <input type="text" value="${orderData.contactPerson}" class="w-full px-3 py-2 border border-gray-300 rounded-md bg-gray-50 cursor-not-allowed" disabled>
                    </div>
                    <div>
                      <label class="block text-xs text-gray-500 mb-1">ä»“åº“è”ç³»æ–¹å¼</label>
                      <input type="text" value="${orderData.contactPhone}" class="w-full px-3 py-2 border border-gray-300 rounded-md bg-gray-50 cursor-not-allowed" disabled>
                    </div>
                    <div class="md:col-span-2">
                      <label class="block text-xs text-gray-500 mb-1">ä»“åº“åœ°å€</label>
                      <input type="text" value="${orderData.warehouseAddress}" class="w-full px-3 py-2 border border-gray-300 rounded-md bg-gray-50 cursor-not-allowed" disabled>
                    </div>
                  </div>
                </div>
                
                <!-- é¢„çº¦ä¿¡æ¯åŒºå— -->
                <div class="mb-5">
                  <h4 class="text-sm font-semibold text-gray-700 mb-3">é¢„çº¦ä¿¡æ¯</h4>
                  <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div>
                      <label class="block text-xs text-gray-500 mb-1"><span class="text-red-500">*</span>å¸è´§æ–¹å¼</label>
                      <select class="w-full px-3 py-2 border border-gray-300 rounded-md bg-gray-50 cursor-not-allowed" disabled data-order-id="${orderData.id}" data-field="deliveryMethod">
                        <option value="">è¯·é€‰æ‹©å¸è´§æ–¹å¼</option>
                        <option value="forklift" selected>live</option>
                        <option value="manual">drop</option>
                      </select>
                    </div>
                    <div>
                      <label class="block text-xs text-gray-500 mb-1"><span class="text-red-500">*</span>å…¥åº“æ—¶é—´</label>
                      <input type="datetime-local" value="2024-12-20T10:30" class="w-full px-3 py-2 border border-gray-300 rounded-md bg-gray-50 cursor-not-allowed" disabled data-order-id="${orderData.id}" data-field="warehouseTime">
                    </div>
                  </div>
                </div>
                
                <!-- è½¦é˜Ÿä¿¡æ¯åŒºå— -->
                <div class="mb-5">
                  <h4 class="text-sm font-semibold text-gray-700 mb-3">è½¦é˜Ÿä¿¡æ¯</h4>
                  <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div>
                      <label class="block text-xs text-gray-500 mb-1"><span class="text-red-500">*</span>åç§°</label>
                      <input type="text" value="${orderData.teamName || 'é¡ºä¸°ç‰©æµè½¦é˜Ÿ'}" placeholder="è¯·è¾“å…¥è½¦é˜Ÿåç§°" class="w-full px-3 py-2 border border-gray-300 rounded-md bg-gray-50 cursor-not-allowed" disabled data-order-id="${orderData.id}" data-field="teamName">
                    </div>
                    <div>
                      <label class="block text-xs text-gray-500 mb-1"><span class="text-red-500">*</span>é‚®ç®±</label>
                      <input type="text" value="team${orderData.id}@example.com" placeholder="è¯·è¾“å…¥è½¦é˜Ÿé‚®ç®±" class="w-full px-3 py-2 border border-gray-300 rounded-md bg-gray-50 cursor-not-allowed" disabled data-order-id="${orderData.id}" data-field="teamEmail">
                    </div>
                    <div>
                      <label class="block text-xs text-gray-500 mb-1">ç”µè¯å·ç </label>
                      <input type="tel" value="13800${orderData.id}0000" placeholder="è¯·è¾“å…¥ç”µè¯å·ç " class="w-full px-3 py-2 border border-gray-300 rounded-md bg-gray-50 cursor-not-allowed" disabled data-order-id="${orderData.id}" data-field="teamPhone">
                    </div>
                    <div>
                      <label class="block text-xs text-gray-500 mb-1">å¤‡ç”¨ç”µè¯å·</label>
                      <input type="tel" value="13900${orderData.id}0000" placeholder="è¯·è¾“å…¥å¤‡ç”¨ç”µè¯å·ç " class="w-full px-3 py-2 border border-gray-300 rounded-md bg-gray-50 cursor-not-allowed" disabled data-order-id="${orderData.id}" data-field="teamBackupPhone">
                    </div>
                    <div class="md:col-span-2">
                      <label class="block text-xs text-gray-500 mb-1">å¤‡æ³¨</label>
                      <textarea value="" rows="2" class="w-full px-3 py-2 border border-gray-300 rounded-md bg-gray-50 cursor-not-allowed" disabled data-order-id="${orderData.id}" data-field="teamRemark">æ ‡å‡†è¿è¾“ï¼Œè¯·æ³¨æ„é˜²æŠ¤æªæ–½</textarea>
                    </div>
                  </div>
                </div>
              </div>
              <!-- å³ä¾§ï¼šæ—¶é—´çº¿ -->
              <div class="w-full md:w-2/5 p-4 sm:p-5 border-t md:border-t-0 md:border-l border-gray-200">
                <h4 class="text-sm font-semibold text-gray-700 mb-3">å…¥åº“æ—¶é—´æµç¨‹</h4>
                <ul class="space-y-4 relative before:absolute before:top-0 before:bottom-0 before:left-4 before:w-0.5 before:bg-gray-200">
                  <li class="relative flex items-start pl-10">
                    <div class="absolute left-0 top-1">
                      <div class="h-8 w-8 rounded-full bg-green-100 flex items-center justify-center text-green-600">
                        <i class="fas fa-calendar-check text-sm"></i>
                      </div>
                    </div>
                    <div class="ml-3">
                      <p class="text-sm font-medium text-gray-800">åˆ›å»ºé¢„çº¦</p>
                      <p class="text-xs text-gray-400">2024/12/10 09:00</p>
                    </div>
                  </li>
                  <li class="relative flex items-start pl-10">
                    <div class="absolute left-0 top-1">
                      <div class="h-8 w-8 rounded-full bg-green-100 flex items-center justify-center text-green-600">
                        <i class="fas fa-file-alt text-sm"></i>
                      </div>
                    </div>
                    <div class="ml-3">
                      <p class="text-sm font-medium text-gray-800">é¢„æŠ¥å®¡æ ¸</p>
                      <p class="text-xs text-gray-400">2024/12/10 10:30</p>
                    </div>
                  </li>
                  <li class="relative flex items-start pl-10">
                    <div class="absolute left-0 top-1">
                      <div class="h-8 w-8 rounded-full bg-green-100 flex items-center justify-center text-green-600">
                        <i class="fas fa-truck text-sm"></i>
                      </div>
                    </div>
                    <div class="ml-3">
                      <p class="text-sm font-medium text-gray-800">è½¦è¾†åˆ°ä»“</p>
                      <p class="text-xs text-gray-400">2024/12/12 10:00</p>
                    </div>
                  </li>
                  <li class="relative flex items-start pl-10">
                    <div class="absolute left-0 top-1">
                      <div class="h-8 w-8 rounded-full bg-gray-200 flex items-center justify-center text-gray-500">
                        <i class="fas fa-sync-alt text-sm"></i>
                      </div>
                    </div>
                    <div class="ml-3">
                      <p class="text-sm font-medium text-gray-500">æ’é˜Ÿç­‰å¾…</p>
                      <p class="text-xs text-gray-400">å¾…å¤„ç†</p>
                    </div>
                  </li>
                  <li class="relative flex items-start pl-10">
                    <div class="absolute left-0 top-1">
                      <div class="h-8 w-8 rounded-full bg-gray-200 flex items-center justify-center text-gray-500">
                        <i class="fas fa-box-open text-sm"></i>
                      </div>
                    </div>
                    <div class="ml-3">
                      <p class="text-sm font-medium text-gray-500">å¸è´§/æ‰“æ‰˜</p>
                      <p class="text-xs text-gray-400">å¾…å¤„ç†</p>
                    </div>
                  </li>
                  <li class="relative flex items-start pl-10">
                    <div class="absolute left-0 top-1">
                      <div class="h-8 w-8 rounded-full bg-gray-200 flex items-center justify-center text-gray-500">
                        <i class="fas fa-boxes text-sm"></i>
                      </div>
                    </div>
                    <div class="ml-3">
                      <p class="text-sm font-medium text-gray-500">å¸è´§/æ‰“æ‰˜/ä¸Šæ¶</p>
                      <p class="text-xs text-gray-400">2024/12/12 14:00</p>
                    </div>
                  </li>
                </ul>
              </div>
            </div>
          </div>
        `;
        
        // æŠ˜å /å±•å¼€åŠŸèƒ½
        const header = card.querySelector(`#card-header-${orderData.id}`);
        const collapseContent = card.querySelector(`#${collapseId}`);
        const toggleIcon = card.querySelector(`#toggle-icon-${orderData.id}`);
        
        if (header && collapseContent && toggleIcon) {
          header.addEventListener('click', function(e) {
            if (!e.target.closest('button')) {
              collapseContent.classList.toggle('hidden');
              toggleIcon.querySelector('i').classList.toggle('fa-chevron-down');
              toggleIcon.querySelector('i').classList.toggle('fa-chevron-up');
            }
          });
        }
        
        // åˆå§‹åŒ–é‚®ç®±æ ‡ç­¾åŠŸèƒ½
        const emailInput = card.querySelector(`.team-email[data-order-id="${orderData.id}"]`);
        const emailTagsContainer = card.querySelector(`.email-tags-${orderData.id}`);
        const emailError = card.querySelector(`.email-error-${orderData.id}`);
        
        if (emailInput && emailTagsContainer && emailError) {
          // é‚®ç®±éªŒè¯æ­£åˆ™è¡¨è¾¾å¼
          const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
          
          // å¤„ç†é‚®ç®±è¾“å…¥
          emailInput.addEventListener('keydown', function(e) {
            if (e.key === 'Enter') {
              e.preventDefault();
              const email = this.value.trim();
              
              if (email && emailRegex.test(email)) {
                // åˆ›å»ºé‚®ç®±æ ‡ç­¾
                const tag = document.createElement('div');
                tag.className = 'email-tag bg-primary/10 text-primary px-2 py-1 rounded-md text-sm flex items-center gap-1 h-8';
                tag.setAttribute('data-email', email);
                
                // åˆ›å»ºæ ‡ç­¾å†…å®¹
                const emailSpan = document.createElement('span');
                emailSpan.textContent = email;
                
                // åˆ›å»ºåˆ é™¤æŒ‰é’®
                const deleteBtn = document.createElement('button');
                deleteBtn.type = 'button';
                deleteBtn.className = 'delete-email ml-1 text-primary/70 hover:text-primary';
                deleteBtn.innerHTML = '<i class="fas fa-times-circle"></i>';
                
                // æ·»åŠ åˆ é™¤äº‹ä»¶
                deleteBtn.addEventListener('click', function() {
                  tag.remove();
                });
                
                // ç»„è£…æ ‡ç­¾
                tag.appendChild(emailSpan);
                tag.appendChild(deleteBtn);
                
                // æ’å…¥åˆ°è¾“å…¥æ¡†ä¹‹å‰
                emailTagsContainer.insertBefore(tag, emailInput);
                
                this.value = '';
              } else {
                emailError.classList.remove('hidden');
                setTimeout(() => {
                  emailError.classList.add('hidden');
                }, 3000);
              }
            }
          });
        }
        
        // ç§»é™¤äº†å•ä¸ªå¡ç‰‡çš„è¡¨å•éªŒè¯å’Œæäº¤é€»è¾‘ï¼Œç»Ÿä¸€ä½¿ç”¨å…¨å±€è¡¨å•
        
        return card;
      }
      
      // éªŒè¯å…¨å±€è¡¨å•å¹¶æ›´æ–°æäº¤æŒ‰é’®çŠ¶æ€
      function validateGlobalForm() {
        const deliveryMethod = document.getElementById('global-delivery-method').value;
        const warehouseTime = document.getElementById('global-warehouse-time').value;
        const submitBtn = document.getElementById('global-submit-btn');
        
        if (submitBtn) {
          // åªæ£€æŸ¥å¿…å¡«é¡¹æ˜¯å¦å·²å¡«å†™
          const hasRequiredFields = deliveryMethod && warehouseTime;
          
          // é€»è¾‘ï¼šåªæœ‰å½“æ‰€æœ‰å¿…å¡«é¡¹å·²å¡«å†™æ—¶ï¼Œæ‰å¯ç”¨æŒ‰é’®
          if (hasRequiredFields) {
            submitBtn.disabled = false;
            submitBtn.className = 'w-full bg-primary hover:bg-primary/90 text-white px-5 py-2 rounded-md transition-colors';
          } else {
            submitBtn.disabled = true;
            submitBtn.className = 'w-full bg-gray-300 text-gray-500 cursor-not-allowed px-5 py-2 rounded-md transition-colors';
          }
        }
      }
      
      // å…¨å±€æäº¤è®¢å•è¡¨å•
      function submitGlobalOrderForm() {
        // è·å–æŸœå·ï¼ˆç›¸åŒæŸœå·åªæäº¤ä¸€æ¬¡ï¼‰
        const containerNo = document.getElementById('container-no').value;
        
        // è·å–å…¨å±€è¡¨å•æ•°æ®
        const deliveryMethod = document.getElementById('global-delivery-method').value;
        const warehouseTime = document.getElementById('global-warehouse-time').value;
        const teamPhone = document.getElementById('global-team-phone').value;
        const teamBackupPhone = document.getElementById('global-team-backup-phone').value;
        const teamRemark = document.getElementById('global-team-remark').value;
        const teamEmail = document.getElementById('global-team-email').value;
        
        // è·å–é‚®ç®±æ•°æ®ï¼ˆä»å•ä¸€è¾“å…¥æ¡†ï¼‰
        const emails = teamEmail ? [teamEmail] : [];
        
        // ç­›é€‰çŠ¶æ€ä¸ºå¾…é¢„çº¦æˆ–å¾…ä»“åº“ç¡®è®¤ï¼ˆå®¡æ ¸ï¼‰çš„è®¢å•
        const pendingOrders = orderData.filter(order => 
          order.status === 'å¾…é¢„çº¦' || order.status === 'å¾…ä»“åº“å®¡æ ¸' || order.status === 'å¾…ä»“åº“ç¡®è®¤'
        );
        
        // æ£€æŸ¥æ˜¯å¦å­˜åœ¨å¯æäº¤çš„è®¢å•
        if (pendingOrders.length === 0) {
          alert('æ²¡æœ‰å¯æäº¤çš„è®¢å•ï¼Œä»…æ”¯æŒæäº¤çŠ¶æ€ä¸º"å¾…é¢„çº¦"å’Œ"å¾…ä»“åº“ç¡®è®¤"çš„è®¢å•');
          return;
        }
        
        // è·å–å¾…æäº¤è®¢å•çš„ID
        const orderIds = pendingOrders.map(order => order.id);
        
        // æ„é€ æäº¤æ•°æ® - åªæäº¤ç¬¦åˆçŠ¶æ€è¦æ±‚çš„è®¢å•
        const formData = {
          containerNo,
          orderIds,
          deliveryMethod,
          warehouseTime,
          teamPhone,
          teamBackupPhone,
          teamRemark,
          emails
        };
        
        console.log('å…¨å±€æäº¤è®¢å•æ•°æ®:', formData);
        
        // ä¸ºæ¯ä¸ªæäº¤çš„è®¢å•åˆ›å»ºå†å²è®°å½•
        pendingOrders.forEach(order => {
          const historyRecord = {
            id: Date.now() + order.id, // ä½¿ç”¨æ—¶é—´æˆ³+è®¢å•IDç¡®ä¿å”¯ä¸€æ€§
            orderNo: order.orderNo,
            warehouseNo: order.warehouseNo,
            contactPerson: order.contactPerson,
            contactPhone: order.contactPhone,
            teamName: order.teamName,
            appointmentTime: warehouseTime,
            createTime: new Date().toISOString(),
            status: 'pending'
          };
          
          // æ·»åŠ åˆ°å†å²è®°å½•
          addHistoryRecord(historyRecord);
        });
        
        // æ¨¡æ‹Ÿæäº¤æˆåŠŸï¼Œç»Ÿè®¡æˆåŠŸæ•°é‡
        // æ˜¾ç¤ºæ›´çªå‡ºçš„æç¤ºä¿¡æ¯
        alert(`âœ… é¢„çº¦æäº¤æˆåŠŸï¼\nğŸ“‹ å·²æˆåŠŸæäº¤ ${pendingOrders.length} ä¸ªè®¢å•\nâš ï¸ âš ï¸ âš ï¸ é‡è¦æç¤ºï¼šç³»ç»Ÿä»…å¤„ç†"å¾…é¢„çº¦"å’Œ"å¾…ä»“åº“ç¡®è®¤"çŠ¶æ€çš„è®¢å• âš ï¸ âš ï¸ âš ï¸`);
      }
      
      // ä¸ºå…¨å±€è¡¨å•æ·»åŠ äº‹ä»¶ç›‘å¬
      const globalDeliveryMethod = document.getElementById('global-delivery-method');
      const globalWarehouseTime = document.getElementById('global-warehouse-time');
      const globalSubmitBtn = document.getElementById('global-submit-btn');
      
      if (globalDeliveryMethod) {
        globalDeliveryMethod.addEventListener('change', validateGlobalForm);
      }
      
      if (globalWarehouseTime) {
        globalWarehouseTime.addEventListener('change', validateGlobalForm);
      }
      
      if (globalSubmitBtn) {
        globalSubmitBtn.addEventListener('click', submitGlobalOrderForm);
      }
      
      // åˆå§‹åŒ–å…¨å±€é‚®ç®±æ ‡ç­¾åŠŸèƒ½
      const globalEmailInput = document.getElementById('global-team-email');
      const globalEmailTagsContainer = document.getElementById('global-email-tags');
      const globalEmailError = document.getElementById('global-email-error');
      
      if (globalEmailInput && globalEmailTagsContainer && globalEmailError) {
        // é‚®ç®±éªŒè¯æ­£åˆ™è¡¨è¾¾å¼
        const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
        
        // å¤„ç†é‚®ç®±è¾“å…¥
        globalEmailInput.addEventListener('keydown', function(e) {
          if (e.key === 'Enter') {
            e.preventDefault();
            const email = this.value.trim();
            
            if (email && emailRegex.test(email)) {
              // åˆ›å»ºé‚®ç®±æ ‡ç­¾
              const tag = document.createElement('div');
              tag.className = 'email-tag bg-primary/10 text-primary px-2 py-1 rounded-md text-sm flex items-center gap-1 h-8';
              tag.setAttribute('data-email', email);
              
              // åˆ›å»ºæ ‡ç­¾å†…å®¹
              const emailSpan = document.createElement('span');
              emailSpan.textContent = email;
              
              // åˆ›å»ºåˆ é™¤æŒ‰é’®
              const deleteBtn = document.createElement('button');
              deleteBtn.type = 'button';
              deleteBtn.className = 'delete-email ml-1 text-primary/70 hover:text-primary';
              deleteBtn.innerHTML = '<i class="fas fa-times-circle"></i>';
              
              // æ·»åŠ åˆ é™¤äº‹ä»¶
              deleteBtn.addEventListener('click', function() {
                tag.remove();
              });
              
              // ç»„è£…æ ‡ç­¾
              tag.appendChild(emailSpan);
              tag.appendChild(deleteBtn);
              
              // æ’å…¥åˆ°è¾“å…¥æ¡†ä¹‹å‰
              globalEmailTagsContainer.insertBefore(tag, globalEmailInput);
              
              this.value = '';
            } else {
              globalEmailError.classList.remove('hidden');
              setTimeout(() => {
                globalEmailError.classList.add('hidden');
              }, 3000);
            }
          }
        });
      }

      // å†å²è®°å½•ç›¸å…³å‡½æ•°
      function showHistoryModal() {
        if (!currentUser) {
          showToast('è¯·å…ˆç™»å½•åå†æŸ¥çœ‹å†å²è®°å½•');
          showLoginModal();
          return;
        }
        
        // åŠ è½½å†å²è®°å½•
        loadHistoryRecords();
        
        // æ˜¾ç¤ºæ¨¡æ€æ¡†
        historyModal.classList.remove('hidden');
        document.body.style.overflow = 'hidden';
      }
      
      function hideHistoryModal() {
        historyModal.classList.add('hidden');
        document.body.style.overflow = 'auto';
      }
      
      function loadHistoryRecords() {
        // ä»localStorageè·å–å†å²è®°å½•
        const historyKey = `history_${currentUser.username}`;
        const historyData = localStorage.getItem(historyKey);
        const records = historyData ? JSON.parse(historyData) : [];
        
        // æ˜¾ç¤ºå†å²è®°å½•
        displayHistoryRecords(records);
      }
      
      function displayHistoryRecords(records) {
        if (records.length === 0) {
          historyList.innerHTML = '';
          historyEmpty.classList.remove('hidden');
          return;
        }
        
        historyEmpty.classList.add('hidden');
        historyList.innerHTML = '';
        
        records.forEach(record => {
          const recordElement = createHistoryRecordElement(record);
          historyList.appendChild(recordElement);
        });
      }
      
      function createHistoryRecordElement(record) {
        const div = document.createElement('div');
        div.className = 'bg-white border border-gray-200 rounded-lg p-4 hover:shadow-md transition-shadow';
        
        const statusClass = getStatusClass(record.status);
        const statusText = getStatusText(record.status);
        
        div.innerHTML = `
          <div class="flex justify-between items-start mb-3">
            <div>
              <h4 class="font-medium text-gray-800">è®¢å•å·: ${record.orderNo}</h4>
              <p class="text-sm text-gray-600">ä»“åº“ç¼–å·: ${record.warehouseNo}</p>
            </div>
            <span class="px-2 py-1 text-xs rounded-full ${statusClass}">${statusText}</span>
          </div>
          
          <div class="grid grid-cols-2 gap-4 text-sm text-gray-600 mb-3">
            <div>
              <span class="font-medium">è”ç³»äºº:</span> ${record.contactPerson}
            </div>
            <div>
              <span class="font-medium">ç”µè¯:</span> ${record.contactPhone}
            </div>
            <div>
              <span class="font-medium">è½¦é˜Ÿ:</span> ${record.teamName}
            </div>
            <div>
              <span class="font-medium">é¢„çº¦æ—¶é—´:</span> ${new Date(record.appointmentTime).toLocaleString()}
            </div>
          </div>
          
          <div class="text-sm text-gray-500">
            <span class="font-medium">åˆ›å»ºæ—¶é—´:</span> ${new Date(record.createTime).toLocaleString()}
          </div>
        `;
        
        return div;
      }
      
      function getStatusClass(status) {
        switch (status) {
          case 'pending':
            return 'bg-yellow-100 text-yellow-800';
          case 'approved':
            return 'bg-green-100 text-green-800';
          case 'rejected':
            return 'bg-red-100 text-red-800';
          default:
            return 'bg-gray-100 text-gray-800';
        }
      }
      
      function getStatusText(status) {
        switch (status) {
          case 'pending':
            return 'å¾…å®¡æ ¸';
          case 'approved':
            return 'å·²å®¡æ ¸';
          case 'rejected':
            return 'å·²æ‹’ç»';
          default:
            return 'æœªçŸ¥çŠ¶æ€';
        }
      }
      
      function filterHistoryRecords() {
        const startDate = historyStartDate.value;
        const endDate = historyEndDate.value;
        const statusFilter = historyStatusFilter.value;
        
        // è·å–æ‰€æœ‰å†å²è®°å½•
        const historyKey = `history_${currentUser.username}`;
        const historyData = localStorage.getItem(historyKey);
        let records = historyData ? JSON.parse(historyData) : [];
        
        // åº”ç”¨ç­›é€‰æ¡ä»¶
        if (startDate) {
          records = records.filter(record => {
            return new Date(record.createTime) >= new Date(startDate);
          });
        }
        
        if (endDate) {
          records = records.filter(record => {
            return new Date(record.createTime) <= new Date(endDate + ' 23:59:59');
          });
        }
        
        if (statusFilter) {
          records = records.filter(record => record.status === statusFilter);
        }
        
        // æ˜¾ç¤ºç­›é€‰åçš„è®°å½•
        displayHistoryRecords(records);
      }
      
      function resetHistoryFilter() {
        historyStartDate.value = '';
        historyEndDate.value = '';
        historyStatusFilter.value = '';
        
        // é‡æ–°åŠ è½½æ‰€æœ‰è®°å½•
        loadHistoryRecords();
      }
      
      function initHistoryRecords() {
        // åˆå§‹åŒ–å†å²è®°å½•æ•°æ®ï¼ˆå¦‚æœä¸å­˜åœ¨ï¼‰
        if (currentUser) {
          const historyKey = `history_${currentUser.username}`;
          const historyData = localStorage.getItem(historyKey);
          
          if (!historyData) {
            // åˆ›å»ºç¤ºä¾‹å†å²è®°å½•
            const sampleRecords = [
              {
                id: 1,
                orderNo: 'ORD20241201001',
                warehouseNo: 'WH20241201001',
                contactPerson: 'å¼ ä¸‰',
                contactPhone: '13800138000',
                teamName: 'é¡ºä¸°è½¦é˜Ÿ',
                appointmentTime: '2024-12-01T10:30:00',
                createTime: '2024-12-01T09:00:00',
                status: 'approved'
              },
              {
                id: 2,
                orderNo: 'ORD20241128001',
                warehouseNo: 'WH20241128001',
                contactPerson: 'æå››',
                contactPhone: '13900139000',
                teamName: 'ä¸­å®¢è½¦é˜Ÿ',
                appointmentTime: '2024-11-28T14:00:00',
                createTime: '2024-11-28T10:30:00',
                status: 'pending'
              },
              {
                id: 3,
                orderNo: 'ORD20241125001',
                warehouseNo: 'WH20241125001',
                contactPerson: 'ç‹äº”',
                contactPhone: '13700137000',
                teamName: 'éŸµè¾¾è½¦é˜Ÿ',
                appointmentTime: '2024-11-25T09:00:00',
                createTime: '2024-11-25T08:00:00',
                status: 'rejected'
              }
            ];
            
            localStorage.setItem(historyKey, JSON.stringify(sampleRecords));
          }
        }
      }
      
      // æ·»åŠ å†å²è®°å½•å‡½æ•°
      function addHistoryRecord(orderData) {
        if (!currentUser) return;
        
        const historyKey = `history_${currentUser.username}`;
        const historyData = localStorage.getItem(historyKey);
        const records = historyData ? JSON.parse(historyData) : [];
        
        const newRecord = {
          id: Date.now(),
          orderNo: orderData.orderNo,
          warehouseNo: orderData.warehouseNo,
          contactPerson: orderData.contactPerson,
          contactPhone: orderData.contactPhone,
          teamName: orderData.teamName,
          appointmentTime: new Date().toISOString(),
          createTime: new Date().toISOString(),
          status: 'pending'
        };
        
        records.unshift(newRecord);
        localStorage.setItem(historyKey, JSON.stringify(records));
      }

      // åˆå§‹åŒ–é¡µé¢
      function initPage() {
        // æ£€æŸ¥ç™»å½•çŠ¶æ€
        checkLoginStatus();
        
        // åˆå§‹åŒ–å†å²è®°å½•
        initHistoryRecords();
        
        // é¡µé¢é»˜è®¤åªæ˜¾ç¤ºç©ºçŠ¶æ€ï¼Œå…¶ä»–å†…å®¹ä¿æŒéšè—
        // ä¸è‡ªåŠ¨æ˜¾ç¤ºè®¢å•å’Œé¢„çº¦ä¿¡æ¯ï¼Œç­‰å¾…ç”¨æˆ·æŸ¥è¯¢
      }

      // é¡µé¢åŠ è½½å®Œæˆååˆå§‹åŒ–
      initPage();
    });
    </script>
  </body>
</html>
