<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>系统操作手册</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css" rel="stylesheet">
  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            primary: '#165DFF',
            secondary: '#0F3FA8',
            neutral: '#F5F7FA',
            'neutral-dark': '#E5E6EB',
            success: '#00B42A',
            warning: '#FF7D00',
            danger: '#F53F3F',
            text: {
              primary: '#1D2129',
              secondary: '#4E5969',
              tertiary: '#86909C'
            }
          },
          fontFamily: {
            sans: ['Inter', 'system-ui', 'sans-serif'],
          },
        },
      }
    }
  </script>
  <style type="text/tailwindcss">
    @layer utilities {
      .content-auto {
        content-visibility: auto;
      }
      .sidebar-item-active {
        @apply bg-primary/10 text-primary border-l-4 border-primary;
      }
      .system-tab-active {
        @apply bg-primary text-white;
      }
      .transition-height {
        transition: max-height 0.3s ease;
      }
      .manual-content h4 {
        @apply text-lg font-semibold mb-3 mt-6;
      }
      .manual-content p {
        @apply mb-4;
      }
      .manual-content ul, .manual-content ol {
        @apply pl-5 mb-4;
      }
      .manual-content ul {
        @apply list-disc space-y-1;
      }
      .manual-content ol {
        @apply list-decimal space-y-2;
      }
    }
  </style>
</head>
<body class="bg-neutral font-sans text-text-primary min-h-screen flex flex-col">
  <!-- 顶部导航栏 -->
  <header class="bg-white shadow-sm z-10">
    <div class="container mx-auto px-4">
      <div class="flex items-center justify-between h-16">
        <!-- 左侧Logo和标题 -->
        <div class="flex items-center space-x-4">
          <button id="sidebar-toggle" class="lg:hidden text-text-primary hover:text-primary">
            <i class="fa fa-bars text-xl"></i>
          </button>
          <div class="flex items-center">
            <i class="fa fa-cogs text-primary text-2xl mr-2"></i>
            <h1 class="text-xl font-semibold">企业系统操作手册平台</h1>
          </div>
        </div>
        
        <!-- 右侧搜索和用户信息 -->
        <div class="flex items-center space-x-6">
          <div class="relative hidden md:block">
            <input type="text" id="global-search" placeholder="搜索所有手册内容..." 
                  class="pl-10 pr-4 py-2 rounded-md border border-neutral-dark focus:outline-none focus:ring-2 focus:ring-primary/30 focus:border-primary w-64">
            <i class="fa fa-search absolute left-3 top-1/2 transform -translate-y-1/2 text-text-tertiary"></i>
          </div>
          
          <div class="flex items-center space-x-3">
            <button class="text-text-secondary hover:text-primary relative">
              <i class="fa fa-history text-lg"></i>
              <span class="absolute -top-1 -right-1 bg-primary text-white text-xs rounded-full h-4 w-4 flex items-center justify-center">5</span>
            </button>
            <div class="flex items-center cursor-pointer">
              <span class="ml-2 hidden md:inline">张经理</span>
              <i class="fa fa-angle-down ml-1 text-text-tertiary"></i>
            </div>
          </div>
        </div>
      </div>
    </div>
  </header>

  <!-- 系统选择栏 -->
  <div class="bg-white border-b border-neutral-dark py-3 z-5">
    <div class="container mx-auto px-4">
      <div class="flex items-center">
        <div class="flex overflow-x-auto pb-2 system-tabs" style="scrollbar-width: none;">
          <button class="system-tab system-tab-active whitespace-nowrap px-4 py-2 rounded-md mr-2 font-medium transition-colors" data-system="erp">
            ERP系统
          </button>
          <button class="system-tab whitespace-nowrap px-4 py-2 rounded-md mr-2 font-medium bg-neutral text-text-primary hover:bg-primary/10 transition-colors" data-system="crm">
            CRM系统
          </button>
          <button class="system-tab whitespace-nowrap px-4 py-2 rounded-md mr-2 font-medium bg-neutral text-text-primary hover:bg-primary/10 transition-colors" data-system="hrm">
            HRM系统
          </button>
          <button class="system-tab whitespace-nowrap px-4 py-2 rounded-md mr-2 font-medium bg-neutral text-text-primary hover:bg-primary/10 transition-colors" data-system="wms">
            WMS系统
          </button>
          <button class="system-tab whitespace-nowrap px-4 py-2 rounded-md font-medium bg-neutral text-text-primary hover:bg-primary/10 transition-colors" data-system="mes">
            MES系统
          </button>
        </div>
      </div>
    </div>
  </div>

  <div class="flex flex-1 overflow-hidden">
    <!-- 侧边栏导航 - 包含模块分类和手册标题 -->
    <aside id="sidebar" class="bg-white w-64 shadow-sm transform -translate-x-full lg:translate-x-0 fixed lg:static h-[calc(100vh-8rem)] z-20 transition-transform duration-300 overflow-y-auto">
      <nav class="py-4">
        <div class="px-4 py-2">
          <h2 class="text-xs uppercase text-text-tertiary font-medium tracking-wider">手册目录</h2>
        </div>
        
        <!-- 导航菜单将通过JS动态生成 -->
        <ul id="menu-container" class="space-y-1">
          <!-- 内容将由JavaScript动态填充 -->
        </ul>
      </nav>
    </aside>

    <!-- 主内容区 - 直接展示手册内容 -->
    <main class="flex-1 overflow-y-auto bg-neutral p-4 lg:p-6">
      <div class="bg-white rounded-lg shadow-sm p-4 lg:p-6">
        <!-- 手册标题栏 -->
        <div class="flex flex-col md:flex-row md:items-center md:justify-between mb-6 pb-4 border-b border-neutral-dark">
          <div>
            <h2 id="manual-title" class="text-[clamp(1.25rem,3vw,1.75rem)] font-semibold">平台店铺管理指南</h2>
            <div class="flex flex-wrap items-center gap-x-6 gap-y-2 text-sm text-text-secondary mt-2">
              <div><span class="text-text-primary font-medium">所属系统：</span><span id="manual-system">ERP系统</span></div>
              <div><span class="text-text-primary font-medium">所属模块：</span><span id="manual-module">电商管理</span></div>
              <div><span class="text-text-primary font-medium">版本号：</span><span id="manual-version">V2.3.0</span></div>
              <div><span class="text-text-primary font-medium">更新日期：</span><span id="manual-date">2025-01-01</span></div>
            </div>
          </div>
        </div>
        
        <!-- 手册内容区 -->
        <div id="manual-content" class="manual-content">
          <h4>1. 平台店铺管理概述</h4>
          <p>平台店铺管理模块用于集中管理企业在各大电商平台（如淘宝、京东、拼多多等）的店铺信息，实现商品同步、订单处理、库存管理和数据分析的一体化操作。本手册详细介绍平台店铺的配置、运营及相关费率（包括燃油费率）的应用方法。</p>
          
          <h4>2. 店铺基本信息配置</h4>
          <p>2.1 新增平台店铺</p>
          <ol>
            <li>登录ERP系统，进入【电商管理】→【平台店铺】→【新增店铺】菜单</li>
            <li>选择电商平台类型（淘宝、京东、拼多多等）</li>
            <li>填写店铺基本信息：店铺名称、店铺编号、店铺URL、负责人等</li>
            <li>配置API授权信息，完成与平台的对接认证</li>
            <li>设置店铺状态为"启用"</li>
            <li>点击【保存】完成店铺创建</li>
          </ol>
          
          <h4>3. 燃油费率应用说明</h4>
          <p>燃油费率是物流成本计算的重要参数，会影响平台店铺的运费模板和定价策略：</p>
          <ul>
            <li>系统默认燃油费率：6.85%（2023年11月最新调整）</li>
            <li>燃油费率更新周期：每月第一个工作日</li>
            <li>应用场景：运费模板计算、物流成本分析、产品定价模型</li>
            <li>手动调整路径：【电商管理】→【系统设置】→【费率管理】→【燃油费率调整】</li>
          </ul>
          
          <p>3.1 燃油费率对运费的影响计算示例：</p>
          <p>基础运费 = 重量运费 + 体积运费</p>
          <p>最终运费 = 基础运费 × (1 + 燃油费率)</p>
          <p>例：基础运费10元，燃油费率6.85%，最终运费 = 10 × (1 + 6.85%) = 10.69元</p>
          
          <h4>4. 店铺运营数据监控</h4>
          <p>4.1 销售数据查看</p>
          <ol>
            <li>进入【电商管理】→【平台店铺】→【店铺数据分析】菜单</li>
            <li>选择需要查看的店铺和时间范围</li>
            <li>系统将展示销售额、订单量、访客数、转化率等关键指标</li>
            <li>点击【导出报表】可下载详细数据进行分析</li>
          </ol>
        </div>
        
        <!-- 手册导航按钮 -->
        <div class="flex justify-between mt-8 pt-4 border-t border-neutral-dark">
          <button id="prev-manual" class="px-4 py-2 border border-neutral-dark rounded hover:bg-neutral transition-colors flex items-center">
            <i class="fa fa-angle-left mr-2"></i>
            <span>上一篇：商品上架流程指南</span>
          </button>
          
          <button id="next-manual" class="px-4 py-2 border border-neutral-dark rounded hover:bg-neutral transition-colors flex items-center">
            <span>下一篇：订单同步与处理操作</span>
            <i class="fa fa-angle-right ml-2"></i>
          </button>
        </div>
      </div>
    </main>
  </div>

  <script>
    // 所有系统的手册数据，新增了平台店铺相关内容并包含燃油费率
    const systemManuals = {
      // ERP系统手册数据
      erp: {
        name: "ERP系统",
        modules: [
          {
            id: "ecommerce",
            name: "电商管理",
            icon: "fa-shopping-bag",
            manuals: {
              501: {
                title: "平台店铺管理指南",
                version: "V2.3.0",
                date: "2023-11-20",
                views: "1,567",
                fuelRate: "6.85% （2023-11-01更新）",
                content: `
                  <h4>1. 平台店铺管理概述</h4>
                  <p>平台店铺管理模块用于集中管理企业在各大电商平台（如淘宝、京东、拼多多等）的店铺信息，实现商品同步、订单处理、库存管理和数据分析的一体化操作。本手册详细介绍平台店铺的配置、运营及相关费率（包括燃油费率）的应用方法。</p>
                  
                  <h4>2. 店铺基本信息配置</h4>
                  <p>2.1 新增平台店铺</p>
                  <ol>
                    <li>登录ERP系统，进入【电商管理】→【平台店铺】→【新增店铺】菜单</li>
                    <li>选择电商平台类型（淘宝、京东、拼多多等）</li>
                    <li>填写店铺基本信息：店铺名称、店铺编号、店铺URL、负责人等</li>
                    <li>配置API授权信息，完成与平台的对接认证</li>
                    <li>设置店铺状态为"启用"</li>
                    <li>点击【保存】完成店铺创建</li>
                  </ol>
                  
                  <h4>3. 燃油费率应用说明</h4>
                  <p>燃油费率是物流成本计算的重要参数，会影响平台店铺的运费模板和定价策略：</p>
                  <ul>
                    <li>系统默认燃油费率：6.85%（2023年11月最新调整）</li>
                    <li>燃油费率更新周期：每月第一个工作日</li>
                    <li>应用场景：运费模板计算、物流成本分析、产品定价模型</li>
                    <li>手动调整路径：【电商管理】→【系统设置】→【费率管理】→【燃油费率调整】</li>
                  </ul>
                  
                  <p>3.1 燃油费率对运费的影响计算示例：</p>
                  <p>基础运费 = 重量运费 + 体积运费</p>
                  <p>最终运费 = 基础运费 × (1 + 燃油费率)</p>
                  <p>例：基础运费10元，燃油费率6.85%，最终运费 = 10 × (1 + 6.85%) = 10.69元</p>
                  
                  <h4>4. 店铺运营数据监控</h4>
                  <p>4.1 销售数据查看</p>
                  <ol>
                    <li>进入【电商管理】→【平台店铺】→【店铺数据分析】菜单</li>
                    <li>选择需要查看的店铺和时间范围</li>
                    <li>系统将展示销售额、订单量、访客数、转化率等关键指标</li>
                    <li>点击【导出报表】可下载详细数据进行分析</li>
                  </ol>
                `,
                prev: 500,
                next: 502
              },
              500: {
                title: "商品上架流程指南",
                version: "V2.2.1",
                date: "2023-11-15",
                views: "2,103",
                fuelRate: "",
                content: `
                  <h4>1. 商品上架概述</h4>
                  <p>商品上架模块用于将企业商品信息发布到各电商平台店铺，支持批量操作和信息同步，确保各平台商品信息的一致性。</p>
                `,
                prev: null,
                next: 501
              },
              502: {
                title: "订单同步与处理操作",
                version: "V2.3.0",
                date: "2023-11-18",
                views: "1,892",
                fuelRate: "",
                content: `
                  <h4>1. 订单同步概述</h4>
                  <p>订单同步功能可自动将各平台店铺的订单信息同步至ERP系统，实现统一管理和处理，提高订单处理效率。</p>
                `,
                prev: 501,
                next: null
              }
            }
          },
          {
            id: "sys",
            name: "系统管理",
            icon: "fa-cog",
            manuals: {
              1: {
                title: "系统初始化配置指南",
                version: "V2.1.0",
                date: "2023-11-15",
                views: "1,284",
                fuelRate: "",
                content: `
                  <h4>1. 概述</h4>
                  <p>本文档详细介绍了ERP系统初次部署后的初始化配置步骤。</p>
                `,
                prev: 2,
                next: 3
              },
              2: {
                title: "用户与权限管理操作手册",
                version: "V1.8.2",
                date: "2023-10-28",
                views: "2,547",
                fuelRate: "",
                content: `
                  <h4>1. 概述</h4>
                  <p>本文档详细介绍了ERP系统中用户管理和权限分配的操作方法。</p>
                `,
                prev: null,
                next: 1
              }
            }
          }
        ]
      },
      // 其他系统数据保持不变
      crm: {
        name: "CRM系统",
        modules: [
          {
            id: "customer",
            name: "客户管理",
            icon: "fa-users",
            manuals: {
              101: {
                title: "客户信息录入指南",
                version: "V1.7.0",
                date: "2023-11-05",
                views: "2,109",
                fuelRate: "",
                content: `
                  <h4>1. 概述</h4>
                  <p>客户信息是CRM系统的基础数据。</p>
                `,
                prev: null,
                next: 102
              }
            }
          }
        ]
      },
      hrm: {
        name: "HRM系统",
        modules: [
          {
            id: "employee",
            name: "员工管理",
            icon: "fa-user",
            manuals: {
              201: {
                title: "员工入职登记操作",
                version: "V1.8.5",
                date: "2023-10-30",
                views: "1,456",
                fuelRate: "",
                content: `
                  <h4>1. 概述</h4>
                  <p>员工入职登记是HRM系统中员工管理的基础操作。</p>
                `,
                prev: null,
                next: 202
              }
            }
          }
        ]
      },
      wms: {
        name: "WMS系统",
        modules: [
          {
            id: "warehouse",
            name: "仓库设置",
            icon: "fa-archive",
            manuals: {
              301: {
                title: "仓库与货位管理设置",
                version: "V2.0.3",
                date: "2023-11-08",
                views: "789",
                fuelRate: "",
                content: `
                  <h4>1. 概述</h4>
                  <p>仓库与货位管理是WMS系统的基础设置。</p>
                `,
                prev: null,
                next: null
              }
            }
          }
        ]
      },
      mes: {
        name: "MES系统",
        modules: [
          {
            id: "production",
            name: "生产管理",
            icon: "fa-industry",
            manuals: {
              401: {
                title: "生产工单创建与执行",
                version: "V2.3.0",
                date: "2023-11-14",
                views: "1,234",
                fuelRate: "",
                content: `
                  <h4>1. 概述</h4>
                  <p>生产工单是MES系统中指导生产执行的核心单据。</p>
                `,
                prev: null,
                next: null
              }
            }
          }
        ]
      }
    };

    // 当前选中的系统和手册
    let currentSystem = "erp";
    let currentManualId = 501; // 默认展示平台店铺手册

    // 初始化页面
    function initPage() {
      // 加载默认系统的菜单
      loadSystemMenu(currentSystem);
      
      // 加载默认手册
      loadManualContent(currentSystem, currentManualId);
      
      // 绑定系统切换事件
      bindSystemTabEvents();
      
      // 绑定侧边栏菜单事件
      bindSidebarEvents();
      
      // 绑定搜索事件
      bindSearchEvents();
      
      // 默认展开第一个菜单组
      setTimeout(() => {
        const firstGroup = document.querySelector('.sidebar-group');
        if (firstGroup) {
          const header = firstGroup.querySelector('.sidebar-group-header');
          if (header) {
            header.click();
          }
        }
      }, 100);
    }

    // 加载系统菜单
    function loadSystemMenu(systemId) {
      const system = systemManuals[systemId];
      if (!system) return;
      
      const menuContainer = document.getElementById('menu-container');
      menuContainer.innerHTML = '';
      
      // 生成每个模块的菜单
      system.modules.forEach(module => {
        // 创建模块组
        const moduleLi = document.createElement('li');
        moduleLi.innerHTML = `
          <div class="sidebar-group">
            <button class="sidebar-group-header w-full flex items-center justify-between px-4 py-3 text-text-primary hover:bg-neutral transition-colors">
              <div class="flex items-center">
                <i class="fa ${module.icon} w-5 text-center mr-3 text-text-secondary"></i>
                <span>${module.name}</span>
              </div>
              <i class="fa fa-angle-down text-text-tertiary transition-transform duration-300"></i>
            </button>
            <ul class="sidebar-group-items pl-10 max-h-0 overflow-hidden transition-height">
              ${Object.entries(module.manuals).map(([id, manual]) => `
                <li>
                  <a href="#" class="manual-link block px-4 py-2 text-sm ${currentSystem === systemId && currentManualId == id ? 'sidebar-item-active' : 'text-text-secondary hover:text-primary hover:bg-primary/5 transition-colors'}" 
                     data-system="${systemId}" data-id="${id}">
                    ${manual.title}
                  </a>
                </li>
              `).join('')}
            </ul>
          </div>
        `;
        
        menuContainer.appendChild(moduleLi);
      });
      
      // 绑定菜单展开/折叠事件
      document.querySelectorAll('.sidebar-group-header').forEach(header => {
        header.addEventListener('click', () => {
          const group = header.parentElement;
          const items = group.querySelector('.sidebar-group-items');
          const icon = header.querySelector('.fa-angle-down');
          
          if (items.style.maxHeight) {
            items.style.maxHeight = null;
            icon.style.transform = 'rotate(0deg)';
          } else {
            items.style.maxHeight = items.scrollHeight + 'px';
            icon.style.transform = 'rotate(180deg)';
          }
        });
      });
    }

    // 加载手册内容
    function loadManualContent(systemId, manualId) {
      const system = systemManuals[systemId];
      if (!system) return;
      
      // 查找手册所在的模块
      let manual = null;
      let moduleName = "";
      
      for (const module of system.modules) {
        if (module.manuals[manualId]) {
          manual = module.manuals[manualId];
          moduleName = module.name;
          break;
        }
      }
      
      if (!manual) return;
      
      // 更新当前选中状态
      currentSystem = systemId;
      currentManualId = manualId;
      
      // 更新标题和元数据
      document.getElementById('manual-title').textContent = manual.title;
      document.getElementById('manual-system').textContent = system.name;
      document.getElementById('manual-module').textContent = moduleName;
      document.getElementById('manual-version').textContent = manual.version;
      document.getElementById('manual-date').textContent = manual.date;
      document.getElementById('manual-views').textContent = manual.views;
      
      // 显示或隐藏燃油费率
      const fuelRateElement = document.getElementById('fuel-rate');
      if (manual.fuelRate) {
        fuelRateElement.textContent = manual.fuelRate;
        fuelRateElement.parentElement.style.display = 'block';
      } else {
        fuelRateElement.parentElement.style.display = 'none';
      }
      
      // 更新内容
      document.getElementById('manual-content').innerHTML = manual.content;
      
      // 更新上一篇/下一篇按钮
      const prevBtn = document.getElementById('prev-manual');
      const nextBtn = document.getElementById('next-manual');
      
      if (manual.prev) {
        prevBtn.onclick = () => {
          loadManualContent(systemId, manual.prev);
          updateSidebarActive(systemId, manual.prev);
        };
        // 查找上一篇手册标题
        let prevManualTitle = "未知手册";
        for (const module of system.modules) {
          if (module.manuals[manual.prev]) {
            prevManualTitle = module.manuals[manual.prev].title;
            break;
          }
        }
        prevBtn.querySelector('span').textContent = `上一篇：${prevManualTitle}`;
        prevBtn.disabled = false;
        prevBtn.classList.remove('opacity-50', 'cursor-not-allowed');
      } else {
        prevBtn.onclick = null;
        prevBtn.querySelector('span').textContent = '上一篇：无';
        prevBtn.disabled = true;
        prevBtn.classList.add('opacity-50', 'cursor-not-allowed');
      }
      
      if (manual.next) {
        nextBtn.onclick = () => {
          loadManualContent(systemId, manual.next);
          updateSidebarActive(systemId, manual.next);
        };
        // 查找下一篇手册标题
        let nextManualTitle = "未知手册";
        for (const module of system.modules) {
          if (module.manuals[manual.next]) {
            nextManualTitle = module.manuals[manual.next].title;
            break;
          }
        }
        nextBtn.querySelector('span').textContent = `下一篇：${nextManualTitle}`;
        nextBtn.disabled = false;
        nextBtn.classList.remove('opacity-50', 'cursor-not-allowed');
      } else {
        nextBtn.onclick = null;
        nextBtn.querySelector('span').textContent = '下一篇：无';
        nextBtn.disabled = true;
        nextBtn.classList.add('opacity-50', 'cursor-not-allowed');
      }
      
      // 滚动到顶部
      window.scrollTo({ top: 0, behavior: 'smooth' });
    }

    // 更新侧边栏选中状态
    function updateSidebarActive(systemId, manualId) {
      // 移除所有激活状态
      document.querySelectorAll('.manual-link').forEach(item => {
        item.classList.remove('sidebar-item-active');
        item.classList.add('text-text-secondary', 'hover:text-primary', 'hover:bg-primary/5');
      });
      
      // 添加当前激活状态
      const activeLink = document.querySelector(`.manual-link[data-system="${systemId}"][data-id="${manualId}"]`);
      if (activeLink) {
        activeLink.classList.add('sidebar-item-active');
        activeLink.classList.remove('text-text-secondary', 'hover:text-primary', 'hover:bg-primary/5');
        
        // 确保所在的菜单组是展开的
        const group = activeLink.closest('.sidebar-group');
        const items = group.querySelector('.sidebar-group-items');
        const icon = group.querySelector('.fa-angle-down');
        
        if (!items.style.maxHeight) {
          items.style.maxHeight = items.scrollHeight + 'px';
          icon.style.transform = 'rotate(180deg)';
        }
      }
    }

    // 绑定系统切换事件
    function bindSystemTabEvents() {
      document.querySelectorAll('.system-tab').forEach(tab => {
        tab.addEventListener('click', () => {
          const systemId = tab.getAttribute('data-system');
          if (systemId === currentSystem) return;
          
          // 更新标签样式
          document.querySelectorAll('.system-tab').forEach(t => {
            t.classList.remove('system-tab-active');
            t.classList.add('bg-neutral', 'text-text-primary', 'hover:bg-primary/10');
          });
          tab.classList.add('system-tab-active');
          tab.classList.remove('bg-neutral', 'text-text-primary', 'hover:bg-primary/10');
          
          // 加载新系统的菜单
          loadSystemMenu(systemId);
          
          // 获取新系统的第一个手册ID
          const system = systemManuals[systemId];
          if (system && system.modules.length > 0) {
            const firstModule = system.modules[0];
            const firstManualId = Object.keys(firstModule.manuals)[0];
            
            // 加载第一个手册
            loadManualContent(systemId, firstManualId);
          }
        });
      });
    }

    // 绑定侧边栏事件
    function bindSidebarEvents() {
      // 移动端侧边栏切换
      document.getElementById('sidebar-toggle').addEventListener('click', () => {
        const sidebar = document.getElementById('sidebar');
        sidebar.classList.toggle('-translate-x-full');
      });
      
      // 委托绑定手册链接事件
      document.getElementById('menu-container').addEventListener('click', (e) => {
        const link = e.target.closest('.manual-link');
        if (link) {
          e.preventDefault();
          
          const systemId = link.getAttribute('data-system');
          const manualId = link.getAttribute('data-id');
          
          // 加载手册内容
          loadManualContent(systemId, manualId);
          
          // 更新激活状态
          updateSidebarActive(systemId, manualId);
          
          // 在移动设备上点击后收起侧边栏
          if (window.innerWidth < 1024) {
            document.getElementById('sidebar').classList.add('-translate-x-full');
          }
        }
      });
    }

    // 绑定搜索事件
    function bindSearchEvents() {
      // 当前手册内搜索功能
      const searchInput = document.getElementById('manual-search');
      searchInput.addEventListener('input', (e) => {
        const searchTerm = e.target.value.toLowerCase();
        const content = document.getElementById('manual-content');
        
        // 移除之前的高亮
        document.querySelectorAll('.search-highlight').forEach(el => {
          const text = document.createTextNode(el.textContent);
          el.parentNode.replaceChild(text, el);
        });
        
        if (!searchTerm) return;
        
        // 搜索并高亮匹配内容
        const walker = document.createTreeWalker(content, NodeFilter.SHOW_TEXT, null, false);
        const textNodes = [];
        
        while (walker.nextNode()) {
          textNodes.push(walker.currentNode);
        }
        
        textNodes.forEach(node => {
          const text = node.textContent;
          const portal  = text.toLowerCase().portal Of(searchTerm);
          
          if (portal  !== -1) {
            const parent = node.parentNode;
            const before = document.createTextNode(text.substring(0, portal ));
            const highlight = document.createElement('span');
            highlight.className = 'search-highlight bg-yellow-200';
            highlight.textContent = text.substring(portal , portal  + searchTerm.length);
            const after = document.createTextNode(text.substring(portal  + searchTerm.length));
            
            parent.replaceChild(after, node);
            parent.insertBefore(highlight, after);
            parent.insertBefore(before, highlight);
          }
        });
        
        // 如果有匹配项，滚动到第一个匹配位置
        const firstHighlight = document.querySelector('.search-highlight');
        if (firstHighlight) {
          firstHighlight.scrollIntoView({ behavior: 'smooth', block: 'center' });
        }
      });
      
      // 全局搜索功能
      const globalSearch = document.getElementById('global-search');
      globalSearch.addEventListener('input', (e) => {
        const searchTerm = e.target.value.toLowerCase();
        if (!searchTerm) {
          document.querySelectorAll('.manual-link').forEach(link => {
            link.style.display = '';
          });
          return;
        }
        
        // 搜索所有手册并显示匹配项
        document.querySelectorAll('.manual-link').forEach(link => {
          const systemId = link.getAttribute('data-system');
          const manualId = link.getAttribute('data-id');
          
          const system = systemManuals[systemId];
          if (!system) return;
          
          // 查找手册
          let manual = null;
          let moduleName = "";
          for (const module of system.modules) {
            if (module.manuals[manualId]) {
              manual = module.manuals[manualId];
              moduleName = module.name;
              break;
            }
          }
          
          if (manual && (
            manual.title.toLowerCase().includes(searchTerm) || 
            manual.content.toLowerCase().includes(searchTerm) ||
            moduleName.toLowerCase().includes(searchTerm) ||
            system.name.toLowerCase().includes(searchTerm) ||
            (manual.fuelRate && manual.fuelRate.toLowerCase().includes(searchTerm))
          )) {
            link.style.display = '';
            
            // 自动展开包含匹配项的菜单组
            const group = link.closest('.sidebar-group');
            const items = group.querySelector('.sidebar-group-items');
            const icon = group.querySelector('.fa-angle-down');
            
            if (!items.style.maxHeight) {
              items.style.maxHeight = items.scrollHeight + 'px';
              icon.style.transform = 'rotate(180deg)';
            }
          } else {
            link.style.display = 'none';
          }
        });
      });
    }

    // 页面加载完成后初始化
    document.addEventListener('DOMContentLoaded', initPage);
  </script>
</body>
</html>
